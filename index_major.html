<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empire Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;900&family=Inter:wght@300;400;500;600;700&family=Rajdhani:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, rgba(15, 23, 42, 1) 0%, rgba(30, 41, 59, 1) 50%, rgba(12, 30, 61, 1) 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        .orbitron {
            font-family: 'Orbitron', sans-serif;
        }
        
        .rajdhani {
            font-family: 'Rajdhani', sans-serif;
        }
        
        /* Cyber Grid Background */
        .cyber-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, rgba(59, 130, 246, 0.03) 1px, transparent 1px),
                linear-gradient(180deg, rgba(59, 130, 246, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: 0;
            animation: gridScroll 20s linear infinite;
            pointer-events: none;
        }
        
        @keyframes gridScroll {
            0% { transform: translateY(0); }
            100% { transform: translateY(50px); }
        }
        
        /* Tab Styles - Not used, but kept for consistency */
        .tab-container {
            background: linear-gradient(135deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.02) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 1rem;
            padding: 0.5rem;
            margin-bottom: 2rem;
        }
        
        .tab-button {
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.6);
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .tab-button:hover {
            color: white;
            background: rgba(255,255,255,0.05);
        }
        
        .tab-button.active {
            background: rgba(59, 130, 246, 0.2);
            color: white;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .tab-content-container {
            /* Added for train tabs */
        }
        
        /* Common Animations */
        .rail-track {
            position: relative;
            height: 4px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                transparent 48%, 
                currentColor 48%, 
                currentColor 52%, 
                transparent 52%, 
                transparent 100%
            );
            overflow: hidden;
        }
        
        .rail-track::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -100%;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255,255,255,0.8) 50%, 
                transparent 100%
            );
            animation: trainPass 3s ease-in-out infinite;
        }
        
        @keyframes trainPass {
            0% { left: -100%; }
            100% { left: 200%; }
        }
        
        /* Card Styles - Adapted for Dashboard */
        .speed-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.02) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border-radius: 1rem;
        }
        
        .speed-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.6s;
        }
        
        .speed-card:hover::before {
            left: 100%;
        }
        
        .speed-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0,0,0,0.4);
            border-color: rgba(255,255,255,0.3);
        }
        
        /* Empire Glow Effects - Adapted for Stock */
        .steam-glow {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #60a5fa 100%);
            box-shadow: 0 0 40px rgba(59, 130, 246, 0.4);
        }
        
        .oil-glow {
            background: linear-gradient(135deg, #991b1b 0%, #dc2626 50%, #f87171 100%);
            box-shadow: 0 0 40px rgba(220, 38, 38, 0.4);
        }
        
        .tech-glow {
            background: linear-gradient(135deg, #065f46 0%, #10b981 50%, #6ee7b7 100%);
            box-shadow: 0 0 40px rgba(16, 185, 129, 0.4);
        }
        
        .empire-1-glow {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
        }
        
        .empire-2-glow {
            background: linear-gradient(135deg, #450a0a 0%, #991b1b 100%);
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.5);
        }
        
        .empire-3-glow {
            background: linear-gradient(135deg, #052e16 0%, #166534 100%);
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.5);
        }
        
        .stat-number {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            background: linear-gradient(135deg, #fff 0%, rgba(255,255,255,0.8) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .velocity-bar {
            height: 8px;
            background: linear-gradient(90deg, 
                rgba(255,255,255,0.2) 0%, 
                currentColor 50%, 
                rgba(255,255,255,0.2) 100%
            );
            border-radius: 4px;
            box-shadow: 0 0 20px currentColor;
            width: 0%;
            transition: width 1.5s ease-out;
        }
        
        /* Table Styles */
        .table-row {
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        
        .table-row:hover {
            background: rgba(59, 130, 246, 0.1);
            border-left-color: #3b82f6;
            transform: translateX(5px);
        }
        
        /* Leader Panel Enhancements */
        .leader-panel {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
        }
        
        .empire-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
            border-radius: 12px;
            margin-right: -20px;
            transition: all 0.3s ease;
        }
        
        .empire-wrapper:hover {
            transform: scale(1.02);
        }
        
        .rank-number {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 3rem;
            font-weight: bold;
            color: #000;
            z-index: 10;
            font-family: 'Orbitron', sans-serif;
        }
        
        .gold-bg { 
            background: linear-gradient(135deg, #FFD700, #FFA500);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        .silver-bg { 
            background: linear-gradient(135deg, #C0C0C0, #A9A9A9);
            box-shadow: 0 0 20px rgba(192, 192, 192, 0.5);
        }
        
        .bronze-bg { 
            background: linear-gradient(135deg, #CD7F32, #B8860B);
            box-shadow: 0 0 20px rgba(205, 127, 50, 0.5);
        }
        
        .flag-img { 
            display: inline-block; 
            width: 20px; 
            height: 14px; 
            object-fit: cover; 
            margin-right: 8px; 
            vertical-align: middle;
            filter: drop-shadow(0 0 2px rgba(255,255,255,0.5));
        }
        
        .name-with-flag { 
            display: inline-flex; 
            align-items: center; 
        }
        
        /* Shimmer Text for Header */
        .shimmer-text { 
            background: linear-gradient(90deg, #fff 0%, #60a5fa 50%, #fff 100%); 
            background-size: 1000px 100%; 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            animation: shimmer 3s linear infinite;
            font-family: 'Orbitron', sans-serif;
        }
        
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        /* Neon Border for Sections */
        .neon-border { 
            position: relative; 
            border: 2px solid transparent; 
            background: linear-gradient(rgba(30, 41, 59, 0.8), rgba(30, 41, 59, 0.8)) padding-box, 
                        linear-gradient(45deg, #3b82f6, #8b5cf6, #3b82f6) border-box; 
        }
        
        /* Glitch for Title */
        .glitch {
            position: relative;
        }
        
        .glitch::before,
        .glitch::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .glitch::before {
            left: 2px;
            text-shadow: -2px 0 #00ffff;
            clip: rect(24px, 550px, 90px, 0);
            animation: glitch-anim 3s infinite linear alternate-reverse;
        }
        
        .glitch::after {
            left: -2px;
            text-shadow: -2px 0 #ff00ff;
            clip: rect(85px, 550px, 140px, 0);
            animation: glitch-anim 2.5s infinite linear alternate-reverse;
        }
        
        @keyframes glitch-anim {
            0% { clip: rect(42px, 9999px, 44px, 0); }
            5% { clip: rect(12px, 9999px, 59px, 0); }
            10% { clip: rect(48px, 9999px, 29px, 0); }
            15% { clip: rect(42px, 9999px, 73px, 0); }
            20% { clip: rect(63px, 9999px, 27px, 0); }
            25% { clip: rect(34px, 9999px, 55px, 0); }
            30% { clip: rect(86px, 9999px, 73px, 0); }
            35% { clip: rect(20px, 9999px, 20px, 0); }
            40% { clip: rect(26px, 9999px, 60px, 0); }
            45% { clip: rect(25px, 9999px, 66px, 0); }
            50% { clip: rect(57px, 9999px, 98px, 0); }
            55% { clip: rect(5px, 9999px, 46px, 0); }
            60% { clip: rect(82px, 9999px, 31px, 0); }
            65% { clip: rect(54px, 9999px, 27px, 0); }
            70% { clip: rect(28px, 9999px, 99px, 0); }
            75% { clip: rect(45px, 9999px, 69px, 0); }
            80% { clip: rect(23px, 9999px, 85px, 0); }
            85% { clip: rect(54px, 9999px, 84px, 0); }
            90% { clip: rect(45px, 9999px, 47px, 0); }
            95% { clip: rect(37px, 9999px, 20px, 0); }
            100% { clip: rect(4px, 9999px, 91px, 0); }
        }
        
        /* Pulse for Icons */
        .pulse-dot {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Data Stream for Tables */
        .data-stream {
            position: relative;
            overflow: hidden;
        }
        
        .data-stream::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 255, 255, 0.3) 50%, 
                transparent 100%);
            animation: stream 2s ease-in-out infinite;
        }
        
        @keyframes stream {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .metric-display {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            letter-spacing: 2px;
        }

        /* Common Rail Track Animation */
        .rail-track, .hsr-track {
            position: relative;
            height: 4px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                transparent 48%, 
                currentColor 48%, 
                currentColor 52%, 
                transparent 52%, 
                transparent 100%
            );
            overflow: hidden;
        }
        
        .rail-track::before, .hsr-track::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -100%;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255,255,255,0.8) 50%, 
                transparent 100%
            );
            animation: trainPass 3s ease-in-out infinite;
        }
        
        /* Sleeper ties */
        .rail-ties {
            background-image: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 30px,
                currentColor 30px,
                currentColor 35px
            );
            height: 2px;
            opacity: 0.3;
        }
        
        /* Metro-specific styles */
        .hologram-card {
            background: linear-gradient(135deg, 
                rgba(10, 20, 50, 0.8) 0%, 
                rgba(20, 30, 60, 0.6) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 255, 255, 0.3);
            box-shadow: 
                0 0 20px rgba(0, 255, 255, 0.2),
                inset 0 0 20px rgba(0, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hologram-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(0, 255, 255, 0.1) 50%,
                transparent 70%
            );
            animation: scan 3s linear infinite;
        }
        
        @keyframes scan {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .hologram-card:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: rgba(0, 255, 255, 0.6);
            box-shadow: 
                0 0 40px rgba(0, 255, 255, 0.4),
                inset 0 0 30px rgba(0, 255, 255, 0.1);
        }
        
        .cyber-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, rgba(0, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(180deg, rgba(0, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: 0;
            animation: gridScroll 20s linear infinite;
        }
        
        @keyframes gridScroll {
            0% { transform: translateY(0); }
            100% { transform: translateY(50px); }
        }
        
        .cyber-border {
            position: relative;
            padding: 2px;
            background: linear-gradient(45deg, #00ffff, #0080ff, #ff00ff, #00ffff);
            background-size: 300% 300%;
            animation: borderFlow 4s ease infinite;
        }
        
        @keyframes borderFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .data-stream {
            position: relative;
            overflow: hidden;
        }
        
        .data-stream::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 255, 255, 0.3) 50%, 
                transparent 100%);
            animation: stream 2s ease-in-out infinite;
        }
        
        @keyframes stream {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .metric-display {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            letter-spacing: 2px;
        }
        
        .pulse-dot {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Empire Glow Effects */
        .steam-glow {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #60a5fa 100%);
            box-shadow: 0 0 40px rgba(59, 130, 246, 0.4);
        }
        
        .oil-glow {
            background: linear-gradient(135deg, #991b1b 0%, #dc2626 50%, #f87171 100%);
            box-shadow: 0 0 40px rgba(220, 38, 38, 0.4);
        }
        
        .tech-glow {
            background: linear-gradient(135deg, #065f46 0%, #10b981 50%, #6ee7b7 100%);
            box-shadow: 0 0 40px rgba(16, 185, 129, 0.4);
        }
        
        .empire-1-glow {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
        }
        
        .empire-2-glow {
            background: linear-gradient(135deg, #450a0a 0%, #991b1b 100%);
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.5);
        }
        
        .empire-3-glow {
            background: linear-gradient(135deg, #052e16 0%, #166534 100%);
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.5);
        }
        
        .stat-number {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            background: linear-gradient(135deg, #fff 0%, rgba(255,255,255,0.8) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .velocity-bar {
            height: 8px;
            background: linear-gradient(90deg, 
                rgba(255,255,255,0.2) 0%, 
                currentColor 50%, 
                rgba(255,255,255,0.2) 100%
            );
            border-radius: 4px;
            box-shadow: 0 0 20px currentColor;
            width: 0%;
            transition: width 1.5s ease-out;
        }
        
        /* Network visualization dots */
        .network-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            position: absolute;
            background: currentColor;
            box-shadow: 0 0 10px currentColor;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
            box-shadow: 0 0 10px currentColor;
        }
        
        /* Glitch effect for Metro header */
        .glitch {
            position: relative;
        }
        
        .glitch::before,
        .glitch::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .glitch::before {
            left: 2px;
            text-shadow: -2px 0 #00ffff;
            clip: rect(24px, 550px, 90px, 0);
            animation: glitch-anim 3s infinite linear alternate-reverse;
        }
        
        .glitch::after {
            left: -2px;
            text-shadow: -2px 0 #ff00ff;
            clip: rect(85px, 550px, 140px, 0);
            animation: glitch-anim 2.5s infinite linear alternate-reverse;
        }
        
        @keyframes glitch-anim {
            0% { clip: rect(42px, 9999px, 44px, 0); }
            5% { clip: rect(12px, 9999px, 59px, 0); }
            10% { clip: rect(48px, 9999px, 29px, 0); }
            15% { clip: rect(42px, 9999px, 73px, 0); }
            20% { clip: rect(63px, 9999px, 27px, 0); }
            25% { clip: rect(34px, 9999px, 55px, 0); }
            30% { clip: rect(86px, 9999px, 73px, 0); }
            35% { clip: rect(20px, 9999px, 20px, 0); }
            40% { clip: rect(26px, 9999px, 60px, 0); }
            45% { clip: rect(25px, 9999px, 66px, 0); }
            50% { clip: rect(57px, 9999px, 98px, 0); }
            55% { clip: rect(5px, 9999px, 46px, 0); }
            60% { clip: rect(82px, 9999px, 31px, 0); }
            65% { clip: rect(54px, 9999px, 27px, 0); }
            70% { clip: rect(28px, 9999px, 99px, 0); }
            75% { clip: rect(45px, 9999px, 69px, 0); }
            80% { clip: rect(23px, 9999px, 85px, 0); }
            85% { clip: rect(54px, 9999px, 84px, 0); }
            90% { clip: rect(45px, 9999px, 47px, 0); }
            95% { clip: rect(37px, 9999px, 20px, 0); }
            100% { clip: rect(4px, 9999px, 91px, 0); }
        }
    </style>
</head>
<body class="p-8 relative">
    <!-- Cyber Grid Background -->
    <div class="cyber-grid"></div>
    
    <div class="relative z-10 max-w-7xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-12">
            <div class="glitch inline-block mb-6" data-text="GLOBAL EMPIRE DASHBOARD">
                <h1 class="text-6xl md:text-7xl font-black mb-2 orbitron bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent shimmer-text">
                    GLOBAL EMPIRE DASHBOARD
                </h1>
            </div>
            <p class="text-2xl text-slate-300 mb-4 rajdhani">Real-time Market Intelligence & Research Analytics</p>
            <div class="flex items-center justify-center gap-4 text-slate-400">
                <div class="w-16 h-px bg-gradient-to-r from-transparent via-slate-500 to-transparent"></div>
                <span class="text-xs tracking-widest">Last Updated: October 20, 2025</span>
                <div class="w-16 h-px bg-gradient-to-r from-transparent via-slate-500 to-transparent"></div>
            </div>
        </div>

        <!-- Market Cap Section -->
        <div class="mb-16 neon-border rounded-2xl p-6">
            <h2 class="text-3xl font-bold text-white mb-6 text-center orbitron flex items-center justify-center gap-3">
                <span class="text-3xl pulse-dot text-blue-400">üíπ</span>
                Total Market Capitalization of all Exchanges
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
                <div class="speed-card rounded-2xl p-6"><div class="leader-panel" id="marketCapLeaderPanel"></div></div>
                <div class="speed-card rounded-2xl p-6"><div class="w-full" id="marketCapPie"></div></div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="speed-card rounded-2xl p-6 empire-1-glow">
                    <div class="mb-4 border-b border-slate-700 pb-3">
                        <h3 class="text-xl font-bold text-white mb-1 orbitron">Empire 1.0: Steam & Colonies</h3>
                        <span class="text-amber-400 text-sm font-bold metric-display">Top Companies</span>
                    </div>
                    <div class="overflow-x-auto data-stream">
                        <table class="w-full text-left text-sm">
                            <thead>
                                <tr class="border-b border-slate-700">
                                    <th class="pb-2 text-slate-400 font-semibold text-xs">#</th>
                                    <th class="pb-2 text-slate-400 font-semibold text-xs">Company</th>
                                    <th class="pb-2 text-slate-400 font-semibold text-xs text-right">Cap</th>
                                </tr>
                            </thead>
                            <tbody class="text-white" id="marketEmpire1Table"></tbody>
                        </table>
                    </div>
                </div>
                <div class="speed-card rounded-2xl p-6 empire-2-glow">
                    <div class="mb-4 border-b border-slate-700 pb-3">
                        <h3 class="text-xl font-bold text-white mb-1 orbitron">Empire 2.0: Oil & Silicon</h3>
                        <span class="text-blue-400 text-sm font-bold metric-display">Top Companies</span>
                    </div>
                    <div class="overflow-x-auto data-stream">
                        <table class="w-full text-left text-sm">
                            <thead>
                                <tr class="border-b border-slate-700">
                                    <th class="pb-2 text-slate-400 font-semibold text-xs">#</th>
                                    <th class="pb-2 text-slate-400 font-semibold text-xs">Company</th>
                                    <th class="pb-2 text-slate-400 font-semibold text-xs text-right">Cap</th>
                                </tr>
                            </thead>
                            <tbody class="text-white" id="marketEmpire2Table"></tbody>
                        </table>
                    </div>
                </div>
                <div class="speed-card rounded-2xl p-6 empire-3-glow">
                    <div class="mb-4 border-b border-slate-700 pb-3">
                        <h3 class="text-xl font-bold text-white mb-1 orbitron">Empire 3.0: Rare Earths & Robotics</h3>
                        <span class="text-green-400 text-sm font-bold metric-display">Top Companies</span>
                    </div>
                    <div class="overflow-x-auto data-stream">
                        <table class="w-full text-left text-sm">
                            <thead>
                                <tr class="border-b border-slate-700">
                                    <th class="pb-2 text-slate-400 font-semibold text-xs">#</th>
                                    <th class="pb-2 text-slate-400 font-semibold text-xs">Company</th>
                                    <th class="pb-2 text-slate-400 font-semibold text-xs text-right">Cap</th>
                                </tr>
                            </thead>
                            <tbody class="text-white" id="marketEmpire3Table"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Container for Infrastructure -->
        <div class="tab-container rounded-2xl mb-8">
            <div class="flex justify-center space-x-2">
                <button class="tab-button active" onclick="switchTab('hsr')">High-Speed Rail</button>
                <button class="tab-button" onclick="switchTab('metro')">Metro Systems</button>
                <button class="tab-button" onclick="switchTab('rail')">Rail Infrastructure</button>
            </div>
        </div>

        <!-- HSR Tab Content -->
        <div id="hsr-tab" class="tab-content active">
            <div class="neon-border rounded-2xl p-6 mb-8">
                <h2 class="text-2xl font-bold orbitron mb-6 flex items-center gap-3 text-white">
                    <span class="text-3xl text-blue-400">üöÇ</span>
                    Total HSR Network Length
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="speed-card rounded-2xl p-6 empire-1-glow">
                        <div class="text-center">
                            <div class="text-4xl font-bold text-white mb-2 stat-number" id="hsr-empire1-total">0</div>
                            <div class="text-sm text-slate-400 mb-1">Total Length (km)</div>
                            <div class="flex justify-between text-xs text-slate-500 mt-4">
                                <span>Lines</span>
                                <span id="hsr-empire1-lines">0</span>
                            </div>
                            <div class="flex justify-between text-xs text-slate-500">
                                <span>Countries</span>
                                <span id="hsr-empire1-countries">0</span>
                            </div>
                            <div class="mt-4 h-2 bg-slate-700 rounded-full">
                                <div class="velocity-bar" style="background-color: #3b82f6;" id="hsr-empire1-bar"></div>
                            </div>
                        </div>
                    </div>
                    <div class="speed-card rounded-2xl p-6 empire-2-glow">
                        <div class="text-center">
                            <div class="text-4xl font-bold text-white mb-2 stat-number" id="hsr-empire2-total">0</div>
                            <div class="text-sm text-slate-400 mb-1">Total Length (km)</div>
                            <div class="flex justify-between text-xs text-slate-500 mt-4">
                                <span>Lines</span>
                                <span id="hsr-empire2-lines">0</span>
                            </div>
                            <div class="flex justify-between text-xs text-slate-500">
                                <span>Countries</span>
                                <span id="hsr-empire2-countries">0</span>
                            </div>
                            <div class="mt-4 h-2 bg-slate-700 rounded-full">
                                <div class="velocity-bar" style="background-color: #ef4444;" id="hsr-empire2-bar"></div>
                            </div>
                        </div>
                    </div>
                    <div class="speed-card rounded-2xl p-6 empire-3-glow">
                        <div class="text-center">
                            <div class="text-4xl font-bold text-white mb-2 stat-number" id="hsr-empire3-total">0</div>
                            <div class="text-sm text-slate-400 mb-1">Total Length (km)</div>
                            <div class="flex justify-between text-xs text-slate-500 mt-4">
                                <span>Lines</span>
                                <span id="hsr-empire3-lines">0</span>
                            </div>
                            <div class="flex justify-between text-xs text-slate-500">
                                <span>Countries</span>
                                <span id="hsr-empire3-countries">0</span>
                            </div>
                            <div class="mt-4 h-2 bg-slate-700 rounded-full">
                                <div class="velocity-bar" style="background-color: #22c55e;" id="hsr-empire3-bar"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="speed-card rounded-2xl p-6">
                        <div class="w-full" id="hsr-totalLengthChart"></div>
                    </div>
                    <div class="speed-card rounded-2xl p-6">
                        <div class="w-full" id="hsr-distributionChart"></div>
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="neon-border rounded-2xl p-6">
                    <h2 class="text-2xl font-bold orbitron mb-6 flex items-center gap-3 text-white">
                        <span class="text-3xl text-yellow-400">üèÜ</span>
                        Top HSR Lines
                    </h2>
                    <div class="w-full" id="hsr-topLinesChart"></div>
                </div>
                <div class="neon-border rounded-2xl p-6">
                    <h2 class="text-2xl font-bold orbitron mb-6 flex items-center gap-3 text-white">
                        <span class="text-3xl text-purple-400">üó∫Ô∏è</span>
                        HSR by Country
                    </h2>
                    <div class="w-full" id="hsr-countryChart"></div>
                </div>
            </div>
            <div class="neon-border rounded-2xl p-6 mt-8">
                <h2 class="text-2xl font-bold orbitron mb-6 text-white">HSR Lines Data</h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="border-b border-slate-700">
                            <tr>
                                <th class="py-4 px-4 text-left text-slate-400 font-semibold">Empire</th>
                                <th class="py-4 px-4 text-left text-slate-400 font-semibold">Country</th>
                                <th class="py-4 px-4 text-left text-slate-400 font-semibold">Line</th>
                                <th class="py-4 px-4 text-right text-slate-400 font-semibold">Length (km)</th>
                            </tr>
                        </thead>
                        <tbody id="hsr-tableBody" class="text-white"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Metro Tab Content -->
        <div id="metro-tab" class="tab-content">
            <div class="neon-border rounded-2xl p-6 mb-8">
                <h2 class="text-2xl font-bold orbitron mb-6 flex items-center gap-3 text-white">
                    <span class="text-3xl text-cyan-400">üöá</span>
                    Total Metro Network Length
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="hologram-card rounded-2xl p-6">
                        <div class="text-center">
                            <div class="text-4xl font-bold text-white mb-2 stat-number" id="metro-empire1-total">0</div>
                            <div class="text-sm text-slate-400 mb-1">Total Length (km)</div>
                            <div class="flex justify-between text-xs text-slate-500 mt-4">
                                <span>Cities</span>
                                <span id="metro-empire1-cities">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="hologram-card rounded-2xl p-6">
                        <div class="text-center">
                            <div class="text-4xl font-bold text-white mb-2 stat-number" id="metro-empire2-total">0</div>
                            <div class="text-sm text-slate-400 mb-1">Total Length (km)</div>
                            <div class="flex justify-between text-xs text-slate-500 mt-4">
                                <span>Cities</span>
                                <span id="metro-empire2-cities">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="hologram-card rounded-2xl p-6">
                        <div class="text-center">
                            <div class="text-4xl font-bold text-white mb-2 stat-number" id="metro-empire3-total">0</div>
                            <div class="text-sm text-slate-400 mb-1">Total Length (km)</div>
                            <div class="flex justify-between text-xs text-slate-500 mt-4">
                                <span>Cities</span>
                                <span id="metro-empire3-cities">0</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="speed-card rounded-2xl p-6">
                        <div class="w-full" id="metro-totalLengthChart"></div>
                    </div>
                    <div class="speed-card rounded-2xl p-6">
                        <div class="w-full" id="metro-distributionChart"></div>
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="neon-border rounded-2xl p-6">
                    <h2 class="text-2xl font-bold orbitron mb-6 flex items-center gap-3 text-white">
                        <span class="text-3xl text-yellow-400">üèôÔ∏è</span>
                        Top Metro Cities
                    </h2>
                    <div class="w-full" id="metro-topCitiesChart"></div>
                </div>
                <div class="neon-border rounded-2xl p-6">
                    <h2 class="text-2xl font-bold orbitron mb-6 flex items-center gap-3 text-white">
                        <span class="text-3xl text-purple-400">üó∫Ô∏è</span>
                        Metro by Country
                    </h2>
                    <div class="w-full" id="metro-countryChart"></div>
                </div>
            </div>
            <div class="neon-border rounded-2xl p-6 mt-8">
                <h2 class="text-2xl font-bold orbitron mb-6 text-white">Metro Systems Data</h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="border-b border-cyan-500/20">
                            <tr>
                                <th class="py-4 px-4 text-left text-cyan-400 font-semibold">Empire</th>
                                <th class="py-4 px-4 text-left text-cyan-400 font-semibold">Country</th>
                                <th class="py-4 px-4 text-left text-cyan-400 font-semibold">City</th>
                                <th class="py-4 px-4 text-left text-cyan-400 font-semibold">Name</th>
                                <th class="py-4 px-4 text-right text-cyan-400 font-semibold">Length (km)</th>
                            </tr>
                        </thead>
                        <tbody id="metro-tableBody" class="text-white"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Rail Tab Content -->
        <div id="rail-tab" class="tab-content">
            <div class="neon-border rounded-2xl p-6 mb-8">
                <h2 class="text-2xl font-bold orbitron mb-6 flex items-center gap-3 text-white">
                    <span class="text-3xl text-gray-400">üõ§Ô∏è</span>
                    Total Rail Network Length
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="speed-card rounded-2xl p-6 empire-1-glow">
                        <div class="text-center">
                            <div class="text-4xl font-bold text-white mb-2 stat-number" id="rail-empire1-total">0</div>
                            <div class="text-sm text-slate-400 mb-1">Total Length (km)</div>
                            <div class="flex justify-between text-xs text-slate-500 mt-4">
                                <span>Lines</span>
                                <span id="rail-empire1-lines">0</span>
                            </div>
                            <div class="flex justify-between text-xs text-slate-500">
                                <span>Countries</span>
                                <span id="rail-empire1-countries">0</span>
                            </div>
                            <div class="mt-4 h-2 bg-slate-700 rounded-full">
                                <div class="velocity-bar" style="background-color: #3b82f6;" id="rail-empire1-bar"></div>
                            </div>
                        </div>
                    </div>
                    <div class="speed-card rounded-2xl p-6 empire-2-glow">
                        <div class="text-center">
                            <div class="text-4xl font-bold text-white mb-2 stat-number" id="rail-empire2-total">0</div>
                            <div class="text-sm text-slate-400 mb-1">Total Length (km)</div>
                            <div class="flex justify-between text-xs text-slate-500 mt-4">
                                <span>Lines</span>
                                <span id="rail-empire2-lines">0</span>
                            </div>
                            <div class="flex justify-between text-xs text-slate-500">
                                <span>Countries</span>
                                <span id="rail-empire2-countries">0</span>
                            </div>
                            <div class="mt-4 h-2 bg-slate-700 rounded-full">
                                <div class="velocity-bar" style="background-color: #ef4444;" id="rail-empire2-bar"></div>
                            </div>
                        </div>
                    </div>
                    <div class="speed-card rounded-2xl p-6 empire-3-glow">
                        <div class="text-center">
                            <div class="text-4xl font-bold text-white mb-2 stat-number" id="rail-empire3-total">0</div>
                            <div class="text-sm text-slate-400 mb-1">Total Length (km)</div>
                            <div class="flex justify-between text-xs text-slate-500 mt-4">
                                <span>Lines</span>
                                <span id="rail-empire3-lines">0</span>
                            </div>
                            <div class="flex justify-between text-xs text-slate-500">
                                <span>Countries</span>
                                <span id="rail-empire3-countries">0</span>
                            </div>
                            <div class="mt-4 h-2 bg-slate-700 rounded-full">
                                <div class="velocity-bar" style="background-color: #22c55e;" id="rail-empire3-bar"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="speed-card rounded-2xl p-6">
                        <div class="w-full" id="rail-totalLengthChart"></div>
                    </div>
                    <div class="speed-card rounded-2xl p-6">
                        <div class="w-full" id="rail-distributionChart"></div>
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="neon-border rounded-2xl p-6">
                    <h2 class="text-2xl font-bold orbitron mb-6 flex items-center gap-3 text-white">
                        <span class="text-3xl text-yellow-400">üèÜ</span>
                        Top Rail Lines
                    </h2>
                    <div class="w-full" id="rail-topLinesChart"></div>
                </div>
                <div class="neon-border rounded-2xl p-6">
                    <h2 class="text-2xl font-bold orbitron mb-6 flex items-center gap-3 text-white">
                        <span class="text-3xl text-purple-400">üó∫Ô∏è</span>
                        Rail by Country
                    </h2>
                    <div class="w-full" id="rail-countryChart"></div>
                </div>
            </div>
            <div class="neon-border rounded-2xl p-6 mt-8">
                <h2 class="text-2xl font-bold orbitron mb-6 text-white">Rail Lines Data</h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="border-b border-slate-700">
                            <tr>
                                <th class="py-4 px-4 text-left text-slate-400 font-semibold">Empire</th>
                                <th class="py-4 px-4 text-left text-slate-400 font-semibold">Country</th>
                                <th class="py-4 px-4 text-left text-slate-400 font-semibold">City</th>
                                <th class="py-4 px-4 text-left text-slate-400 font-semibold">Line</th>
                                <th class="py-4 px-4 text-right text-slate-400 font-semibold">Length (km)</th>
                            </tr>
                        </thead>
                        <tbody id="rail-tableBody" class="text-white"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global Constants
        const GITHUB_BASE = 'https://raw.githubusercontent.com/your-repo/empire-dashboard/main/data/';  // Replace with your GitHub raw base URL
        const hsrEmpireInfo = {
            1: { name: 'Steam & Colonies', color: '#3b82f6', symbol: 'üöÇ' },
            2: { name: 'Oil & Silicon', color: '#ef4444', symbol: 'üõ¢Ô∏è' },
            3: { name: 'Rare Earths & Robotics', color: '#22c55e', symbol: 'ü§ñ' }
        };
        const metroEmpireInfo = {
            '1': { name: 'Steam & Colonies', color: '#3b82f6' },
            '2': { name: 'Oil & Silicon', color: '#ef4444' },
            '3': { name: 'Rare Earths & Robotics', color: '#22c55e' }
        };
        const railEmpireInfo = {
            1: { name: 'Steam & Colonies', color: '#3b82f6', symbol: 'üöÇ' },
            2: { name: 'Oil & Silicon', color: '#ef4444', symbol: 'üõ¢Ô∏è' },
            3: { name: 'Rare Earths & Robotics', color: '#22c55e', symbol: 'ü§ñ' }
        };

        // Tab Switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');
            event.target.classList.add('active');

            // Lazy load data for selected tab
            if (tabName === 'hsr' && !window.hsrDataLoaded) initHSR();
            if (tabName === 'metro' && !window.metroDataLoaded) initMetro();
            if (tabName === 'rail' && !window.railDataLoaded) initRail();
        }

        // Animate Number Function (Global)
        function animateNumber(element, target) {
            const duration = 1500;
            const start = 0;
            const startTime = performance.now();
            
            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const current = Math.floor(start + (target - start) * progress);
                element.textContent = current.toLocaleString();
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }
            
            requestAnimationFrame(update);
        }

        // HSR Functions
        async function loadHSRData() {
            try {
                const response = await fetch(GITHUB_BASE + 'empire_hsr.csv');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: Failed to fetch HSR CSV`);
                }
                const csvText = await response.text();
                const parsed = Papa.parse(csvText, { header: true, skipEmptyLines: true, dynamicTyping: true });
                
                if (parsed.errors.length > 0) {
                    console.warn('Papa.parse warnings:', parsed.errors);
                }
                
                // Map and clean: Use correct column 'Length_km', fix float precision, filter invalids
                return parsed.data
                    .filter(row => row.Empire && row.Country && row.Line && row.Length_km !== undefined)
                    .map(row => {
                        let length = parseFloat(row.Length_km);
                        // Fix float artifacts (e.g., 1595.3999999999999 ‚Üí 1595.4)
                        if (Math.abs(length - Math.round(length)) < 1e-6) {
                            length = Math.round(length);
                        } else if (Math.abs(length * 10 - Math.round(length * 10)) < 1e-6) {
                            length = Math.round(length * 10) / 10;  // Round to 1 decimal
                        }
                        if (isNaN(length) || length <= 0) {
                            console.warn(`Invalid length for row: ${JSON.stringify(row)}`);
                            return null;
                        }
                        return {
                            empire: parseInt(row.Empire),  // Ensure int 1/2/3
                            country: row.Country.trim(),
                            line: row.Line.trim(),
                            length: length
                        };
                    })
                    .filter(row => row !== null);  // Remove invalids
            } catch (error) {
                console.error('Error loading HSR data:', error);
                return [];
            }
        }

        function updateHSRSummaryCards(data) {
            ['1', '2', '3'].forEach(empire => {
                const empireData = data.filter(d => d.empire.toString() === empire);  // String match for safety
                const totalLength = Math.round(empireData.reduce((sum, d) => sum + d.length, 0));  // Round for display
                const lines = empireData.length;
                const countries = new Set(empireData.map(d => d.country)).size;
                
                const totalEl = document.getElementById(`hsr-empire${empire}-total`);
                const linesEl = document.getElementById(`hsr-empire${empire}-lines`);
                const countriesEl = document.getElementById(`hsr-empire${empire}-countries`);
                
                if (totalEl) animateNumber(totalEl, totalLength);  // Animate lengths
                if (linesEl) linesEl.textContent = lines;
                if (countriesEl) countriesEl.textContent = countries;
                
                // Velocity bar (if present)
                const barElement = document.getElementById(`hsr-empire${empire}-bar`);
                if (barElement) {
                    const maxLength = Math.max(...['1','2','3'].map(e => {
                        const ed = data.filter(d => d.empire.toString() === e);
                        return ed.reduce((s, d) => s + d.length, 0);
                    }));
                    const barWidth = maxLength > 0 ? (totalLength / maxLength * 100) : 0;
                    setTimeout(() => { barElement.style.width = barWidth + '%'; }, 500);
                }
            });
        }

        function createHSRTotalLengthChart(data) {
            const empireData = [1,2,3].map(empire => {
                const filtered = data.filter(d => d.empire === empire);
                const total = filtered.reduce((sum, d) => sum + d.length, 0);
                return {
                    empire: empire,
                    total: total,
                    name: hsrEmpireInfo[empire].name,
                    color: hsrEmpireInfo[empire].color
                };
            });

            const trace = {
                x: empireData.map(d => d.name),
                y: empireData.map(d => d.total),
                type: 'bar',
                marker: {
                    color: empireData.map(d => d.color),
                    line: { color: 'rgba(255,255,255,0.2)', width: 1 }
                },
                text: empireData.map(d => d.total.toLocaleString() + ' km'),
                textposition: 'outside',
                textfont: { color: 'white', size: 14, family: 'Orbitron' }
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white', family: 'Inter' },
                xaxis: { showgrid: false },
                yaxis: { 
                    showgrid: true, 
                    gridcolor: 'rgba(255,255,255,0.05)',
                    title: { text: 'Total HSR Length (km)', font: { family: 'Orbitron' } }
                },
                margin: { t: 20, r: 20, b: 60, l: 80 },
                height: 400
            };

            Plotly.newPlot('hsr-totalLengthChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createHSRDistributionChart(data) {
            const empireData = [1,2,3].map(empire => {
                const filtered = data.filter(d => d.empire === empire);
                const total = filtered.reduce((sum, d) => sum + d.length, 0);
                return {
                    empire: empire,
                    total: total,
                    name: hsrEmpireInfo[empire].name,
                    color: hsrEmpireInfo[empire].color
                };
            });

            const trace = {
                labels: empireData.map(d => d.name),
                values: empireData.map(d => d.total),
                type: 'pie',
                marker: {
                    colors: empireData.map(d => d.color),
                    line: { color: 'rgba(255,255,255,0.3)', width: 2 }
                },
                textinfo: 'label+percent',
                textfont: { color: 'white', size: 12, family: 'Rajdhani' },
                hovertemplate: '<b>%{label}</b><br>%{value:,.0f} km<br>%{percent}<extra></extra>',
                hole: 0.4
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white', family: 'Inter' },
                showlegend: false,
                margin: { t: 20, r: 20, b: 20, l: 20 },
                height: 400
            };

            Plotly.newPlot('hsr-distributionChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createHSRTopLinesChart(data) {
            const sortedData = [...data].sort((a, b) => b.length - a.length).slice(0, 15);

            const trace = {
                x: sortedData.map(d => d.length),
                y: sortedData.map(d => `${d.line} (${d.country})`.substring(0, 50)),
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: sortedData.map(d => hsrEmpireInfo[d.empire].color),
                    line: { color: 'rgba(255,255,255,0.2)', width: 1 }
                },
                text: sortedData.map(d => d.length.toLocaleString() + ' km'),
                textposition: 'outside',
                textfont: { color: 'white', size: 11, family: 'Orbitron' }
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white', family: 'Inter', size: 10 },
                xaxis: { 
                    showgrid: true, 
                    gridcolor: 'rgba(255,255,255,0.05)',
                    title: { text: 'Length (km)', font: { family: 'Orbitron' } }
                },
                yaxis: { showgrid: false, automargin: true },
                margin: { t: 20, r: 100, b: 60, l: 250 },
                height: 600
            };

            Plotly.newPlot('hsr-topLinesChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createHSRCountryChart(data) {
            const countryData = {};
            data.forEach(d => {
                if (!countryData[d.country]) {
                    countryData[d.country] = { total: 0, empire: d.empire, country: d.country };
                }
                countryData[d.country].total += d.length;
            });

            const sortedCountries = Object.values(countryData).sort((a, b) => b.total - a.total);

            const trace = {
                x: sortedCountries.map(d => d.country),
                y: sortedCountries.map(d => d.total),
                type: 'bar',
                marker: {
                    color: sortedCountries.map(d => hsrEmpireInfo[d.empire].color),
                    line: { color: 'rgba(255,255,255,0.2)', width: 1 }
                },
                text: sortedCountries.map(d => d.total.toLocaleString() + ' km'),
                textposition: 'outside',
                textfont: { color: 'white', size: 12, family: 'Orbitron' }
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white', family: 'Inter' },
                xaxis: { showgrid: false, tickangle: -45, tickfont: { size: 11 } },
                yaxis: { 
                    showgrid: true, 
                    gridcolor: 'rgba(255,255,255,0.05)',
                    title: { text: 'Total HSR Length (km)', font: { family: 'Orbitron' } }
                },
                margin: { t: 20, r: 20, b: 120, l: 70 },
                height: 450
            };

            Plotly.newPlot('hsr-countryChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createHSRDataTable(data) {
            const tbody = document.getElementById('hsr-tableBody');
            const sortedData = [...data].sort((a, b) => b.length - a.length);
            
            sortedData.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-slate-800 hover:bg-white/5 transition-colors';
                tr.innerHTML = `
                    <td class="py-4 px-4">
                        <span class="inline-flex items-center gap-2">
                            <span class="text-xl">${hsrEmpireInfo[row.empire].symbol}</span>
                            <span class="font-mono">${hsrEmpireInfo[row.empire].name}</span>
                        </span>
                    </td>
                    <td class="py-4 px-4 font-medium">${row.country}</td>
                    <td class="py-4 px-4 text-slate-300">${row.line}</td>
                    <td class="py-4 px-4 text-right font-mono text-lg" style="color: ${hsrEmpireInfo[row.empire].color}">
                        ${row.length.toLocaleString()}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function initHSR() {
            loadHSRData().then(data => {
                if (data.length === 0) {
                    console.error('No valid HSR data loaded - verify empire_hsr.csv format/availability');
                    // Fallback: Set zeros
                    ['1','2','3'].forEach(empire => {
                        document.getElementById(`hsr-empire${empire}-total`).textContent = '0';
                        document.getElementById(`hsr-empire${empire}-lines`).textContent = '0';
                        document.getElementById(`hsr-empire${empire}-countries`).textContent = '0';
                    });
                    return;
                }

                console.log(`Loaded ${data.length} valid HSR lines. Empire totals:`, 
                    [1,2,3].map(e => ({
                        empire: e,
                        total: data.filter(d => d.empire === e).reduce((s, d) => s + d.length, 0)
                    }))
                );
                
                updateHSRSummaryCards(data);
                createHSRTotalLengthChart(data);
                createHSRDistributionChart(data);
                createHSRTopLinesChart(data);
                createHSRCountryChart(data);
                createHSRDataTable(data);
                window.hsrDataLoaded = true;
            }).catch(err => {
                console.error('HSR initialization failed:', err);
            });
        }
        
        // Metro Functions
        async function loadMetroData() {
            try {
                const metroresponse = await fetch(GITHUB_BASE + 'empire_metro.csv');
                const csvText = await metroresponse.text();
                
                // Parse CSV properly handling quoted fields
                const lines = csvText.trim().split('\n');
                const data = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i];
                    const values = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let j = 0; j < line.length; j++) {
                        const char = line[j];
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            values.push(current);
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    values.push(current);
                    
                    if (values.length >= 5) {
                        data.push({
                            empire: values[0].trim(),
                            country: values[1].trim(),
                            city: values[2].trim(),
                            name: values[3].trim() || values[2].trim(),
                            length: parseFloat(values[4]) || 0
                        });
                    }
                }

                return data;
            } catch (error) {
                console.error('Error loading metro data:', error);
                return [];
            }
        }

        function updateMetroSummaryCards(data) {
            ['1', '2', '3'].forEach(empire => {
                const empireData = data.filter(d => d.empire === empire);
                const totalLength = empireData.reduce((sum, d) => sum + d.length, 0);
                const cities = new Set(empireData.map(d => d.city)).size;
                
                const totalEl = document.getElementById(`metro-empire${empire}-total`);
                const citiesEl = document.getElementById(`metro-empire${empire}-cities`);
                
                animateNumber(totalEl, Math.round(totalLength));
                animateNumber(citiesEl, cities);
            });
        }

        function createMetroTotalLengthChart(data) {
            const empireData = ['1', '2', '3'].map(empire => {
                const filtered = data.filter(d => d.empire === empire);
                const total = filtered.reduce((sum, d) => sum + d.length, 0);
                return {
                    empire: empire,
                    total: total,
                    name: metroEmpireInfo[empire].name,
                    color: metroEmpireInfo[empire].color
                };
            });

            const trace = {
                x: empireData.map(d => d.name),
                y: empireData.map(d => d.total),
                type: 'bar',
                marker: {
                    color: empireData.map(d => d.color),
                    line: { color: 'rgba(0, 255, 255, 0.4)', width: 2 }
                },
                text: empireData.map(d => d.total.toLocaleString() + ' km'),
                textposition: 'outside',
                textfont: { color: '#00ffff', size: 14, family: 'Orbitron' }
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#00ffff', family: 'Rajdhani' },
                xaxis: { showgrid: false, color: '#00ffff' },
                yaxis: { 
                    showgrid: true, 
                    gridcolor: 'rgba(0, 255, 255, 0.1)',
                    title: { text: 'Total Length (km)', font: { color: '#00ffff' } }
                },
                margin: { t: 20, r: 20, b: 60, l: 60 },
                height: 300
            };

            Plotly.newPlot('metro-totalLengthChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createMetroDistributionChart(data) {
            const empireData = ['1', '2', '3'].map(empire => {
                const filtered = data.filter(d => d.empire === empire);
                const total = filtered.reduce((sum, d) => sum + d.length, 0);
                return {
                    empire: empire,
                    total: total,
                    name: metroEmpireInfo[empire].name,
                    color: metroEmpireInfo[empire].color
                };
            });

            const trace = {
                labels: empireData.map(d => d.name),
                values: empireData.map(d => d.total),
                type: 'pie',
                marker: {
                    colors: empireData.map(d => d.color),
                    line: { color: 'rgba(0, 255, 255, 0.3)', width: 2 }
                },
                textinfo: 'label+percent',
                textfont: { color: 'white', size: 12, family: 'Rajdhani' },
                hovertemplate: '<b>%{label}</b><br>%{value:,.0f} km<br>%{percent}<extra></extra>'
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#00ffff', family: 'Rajdhani' },
                showlegend: false,
                margin: { t: 20, r: 20, b: 20, l: 20 },
                height: 300
            };

            Plotly.newPlot('metro-distributionChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createMetroTopCitiesChart(data) {
            const sortedData = [...data].sort((a, b) => b.length - a.length).slice(0, 15);

            const trace = {
                x: sortedData.map(d => d.length),
                y: sortedData.map(d => `${d.city}, ${d.country}`),
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: sortedData.map(d => metroEmpireInfo[d.empire].color),
                    line: { color: 'rgba(0, 255, 255, 0.3)', width: 1 }
                },
                text: sortedData.map(d => d.length.toLocaleString() + ' km'),
                textposition: 'outside',
                textfont: { color: '#00ffff', size: 11, family: 'Orbitron' }
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#00ffff', family: 'Rajdhani', size: 11 },
                xaxis: { 
                    showgrid: true, 
                    gridcolor: 'rgba(0, 255, 255, 0.1)',
                    title: { text: 'Length (km)', font: { color: '#00ffff' } }
                },
                yaxis: { showgrid: false, automargin: true },
                margin: { t: 20, r: 100, b: 60, l: 200 },
                height: 500
            };

            Plotly.newPlot('metro-topCitiesChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createMetroCountryChart(data) {
            const countryData = {};
            data.forEach(d => {
                if (!countryData[d.country]) {
                    countryData[d.country] = {
                        total: 0,
                        empire: d.empire,
                        country: d.country
                    };
                }
                countryData[d.country].total += d.length;
            });

            const sortedCountries = Object.values(countryData)
                .sort((a, b) => b.total - a.total)
                .slice(0, 20);

            const trace = {
                x: sortedCountries.map(d => d.country),
                y: sortedCountries.map(d => d.total),
                type: 'bar',
                marker: {
                    color: sortedCountries.map(d => metroEmpireInfo[d.empire].color),
                    line: { color: 'rgba(0, 255, 255, 0.3)', width: 1 }
                },
                text: sortedCountries.map(d => d.total.toLocaleString() + ' km'),
                textposition: 'outside',
                textfont: { color: '#00ffff', size: 11, family: 'Orbitron' }
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#00ffff', family: 'Rajdhani' },
                xaxis: { showgrid: false, tickangle: -45, color: '#00ffff' },
                yaxis: { 
                    showgrid: true, 
                    gridcolor: 'rgba(0, 255, 255, 0.1)',
                    title: { text: 'Total Metro Length (km)', font: { color: '#00ffff' } }
                },
                margin: { t: 20, r: 20, b: 120, l: 60 },
                height: 400
            };

            Plotly.newPlot('metro-countryChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createMetroDataTable(data) {
            const tbody = document.getElementById('metro-tableBody');
            const sortedData = [...data].sort((a, b) => b.length - a.length);
            
            sortedData.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-cyan-500/10 hover:bg-cyan-500/5';
                tr.innerHTML = `
                    <td class="py-4 px-4">
                        <span class="status-indicator pulse-dot" style="background-color: ${metroEmpireInfo[row.empire].color}"></span>
                        <span class="font-mono text-cyan-300">${row.empire}</span>
                    </td>
                    <td class="py-4 px-4 text-slate-300">${row.country}</td>
                    <td class="py-4 px-4 font-semibold text-cyan-200">${row.city}</td>
                    <td class="py-4 px-4 text-slate-400">${row.name}</td>
                    <td class="py-4 px-4 text-right metric-display text-cyan-400">${row.length.toLocaleString()}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function initMetro() {
            loadMetroData().then(data => {
                if (data.length === 0) {
                    console.error('No metro data loaded');
                    return;
                }

                console.log(`Loaded ${data.length} metro systems`);
                updateMetroSummaryCards(data);
                createMetroTotalLengthChart(data);
                createMetroDistributionChart(data);
                createMetroTopCitiesChart(data);
                createMetroCountryChart(data);
                createMetroDataTable(data);
                window.metroDataLoaded = true;
            });
        }
        
        // Rail Functions
        async function loadRailData() {
            try {
                const railresponse = await fetch(GITHUB_BASE + 'empire_rail.csv');
                const csvText = await railresponse.text();
                
                const lines = csvText.trim().split('\n');
                const data = lines.slice(1).map(line => {
                    const values = line.split(',');
                    if (values.length < 5) return null;
                    return {
                        empire: values[0].trim(),
                        country: values[1].trim(),
                        city: values[2].trim(),
                        line: values[3].trim(),
                        length: parseFloat(values[4]) || 0
                    };
                }).filter(d => d !== null && d.length > 0);

                return data;
            } catch (error) {
                console.error('Error loading rail data:', error);
                return [];
            }
        }

        function updateRailSummaryCards(data) {
            const maxLength = Math.max(...['1', '2', '3'].map(empire => {
                const empireData = data.filter(d => d.empire === empire);
                return empireData.reduce((sum, d) => sum + d.length, 0);
            }));

            ['1', '2', '3'].forEach(empire => {
                const empireData = data.filter(d => d.empire === empire);
                const totalLength = empireData.reduce((sum, d) => sum + d.length, 0);
                const lineCount = empireData.length;
                const countries = new Set(empireData.map(d => d.country)).size;
                
                document.getElementById(`rail-empire${empire}-total`).textContent = 
                    totalLength.toLocaleString(undefined, {maximumFractionDigits: 0});
                document.getElementById(`rail-empire${empire}-lines`).textContent = lineCount;
                document.getElementById(`rail-empire${empire}-countries`).textContent = countries;
                
                // Animate velocity bar
                const barElement = document.getElementById(`rail-empire${empire}-bar`);
                const barWidth = (totalLength / maxLength * 100);
                setTimeout(() => {
                    barElement.style.width = barWidth + '%';
                }, 500);
            });
        }

        function createRailTotalLengthChart(data) {
            const empireData = ['1', '2', '3'].map(empire => {
                const filtered = data.filter(d => d.empire === empire);
                const total = filtered.reduce((sum, d) => sum + d.length, 0);
                return { empire, total, name: railEmpireInfo[empire].name, color: railEmpireInfo[empire].color };
            });

            const trace = {
                x: empireData.map(d => d.name),
                y: empireData.map(d => d.total),
                type: 'bar',
                marker: {
                    color: empireData.map(d => d.color),
                    line: { color: 'rgba(255,255,255,0.3)', width: 2 }
                },
                text: empireData.map(d => d.total.toLocaleString() + ' km'),
                textposition: 'outside',
                textfont: { color: 'white', size: 16, family: 'Orbitron' }
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white', family: 'Inter' },
                xaxis: { showgrid: false, tickfont: { size: 12 } },
                yaxis: { 
                    showgrid: true, 
                    gridcolor: 'rgba(255,255,255,0.05)',
                    title: { text: 'Total Length (km)', font: { family: 'Orbitron' } }
                },
                margin: { t: 20, r: 20, b: 60, l: 70 },
                height: 350
            };

            Plotly.newPlot('rail-totalLengthChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createRailDistributionChart(data) {
            const empireData = ['1', '2', '3'].map(empire => {
                const filtered = data.filter(d => d.empire === empire);
                const total = filtered.reduce((sum, d) => sum + d.length, 0);
                return { empire, total, name: railEmpireInfo[empire].name, color: railEmpireInfo[empire].color };
            });

            const trace = {
                labels: empireData.map(d => d.name),
                values: empireData.map(d => d.total),
                type: 'pie',
                marker: {
                    colors: empireData.map(d => d.color),
                    line: { color: '#1e293b', width: 3 }
                },
                textinfo: 'label+percent',
                textfont: { color: 'white', size: 13, family: 'Orbitron' },
                hovertemplate: '<b>%{label}</b><br>%{value:,.0f} km<br>%{percent}<extra></extra>',
                hole: 0.4
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white', family: 'Inter' },
                showlegend: false,
                margin: { t: 20, r: 20, b: 20, l: 20 },
                height: 350
            };

            Plotly.newPlot('rail-distributionChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createRailTopLinesChart(data) {
            const sortedData = [...data].sort((a, b) => b.length - a.length).slice(0, 20);

            const trace = {
                x: sortedData.map(d => d.length),
                y: sortedData.map(d => `${d.city} - ${d.line}`.substring(0, 50)),
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: sortedData.map(d => railEmpireInfo[parseInt(d.empire)].color),
                    line: { color: 'rgba(255,255,255,0.2)', width: 1 }
                },
                text: sortedData.map(d => d.length.toLocaleString() + ' km'),
                textposition: 'outside',
                textfont: { color: 'white', size: 11, family: 'Orbitron' }
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white', family: 'Inter', size: 10 },
                xaxis: { 
                    showgrid: true, 
                    gridcolor: 'rgba(255,255,255,0.05)',
                    title: { text: 'Length (km)', font: { family: 'Orbitron' } }
                },
                yaxis: { showgrid: false, automargin: true },
                margin: { t: 20, r: 100, b: 60, l: 250 },
                height: 600
            };

            Plotly.newPlot('rail-topLinesChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createRailCountryChart(data) {
            const countryData = {};
            data.forEach(d => {
                if (!countryData[d.country]) {
                    countryData[d.country] = { total: 0, empire: parseInt(d.empire), country: d.country };
                }
                countryData[d.country].total += d.length;
            });

            const sortedCountries = Object.values(countryData).sort((a, b) => b.total - a.total);

            const trace = {
                x: sortedCountries.map(d => d.country),
                y: sortedCountries.map(d => d.total),
                type: 'bar',
                marker: {
                    color: sortedCountries.map(d => railEmpireInfo[d.empire].color),
                    line: { color: 'rgba(255,255,255,0.2)', width: 1 }
                },
                text: sortedCountries.map(d => d.total.toLocaleString() + ' km'),
                textposition: 'outside',
                textfont: { color: 'white', size: 12, family: 'Orbitron' }
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white', family: 'Inter' },
                xaxis: { showgrid: false, tickangle: -45, tickfont: { size: 11 } },
                yaxis: { 
                    showgrid: true, 
                    gridcolor: 'rgba(255,255,255,0.05)',
                    title: { text: 'Total Rail Length (km)', font: { family: 'Orbitron' } }
                },
                margin: { t: 20, r: 20, b: 120, l: 70 },
                height: 450
            };

            Plotly.newPlot('rail-countryChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createRailDataTable(data) {
            const tbody = document.getElementById('rail-tableBody');
            const sortedData = [...data].sort((a, b) => b.length - a.length);
            
            sortedData.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-slate-800 hover:bg-white/5 transition-colors';
                tr.innerHTML = `
                    <td class="py-4 px-4">
                        <span class="inline-flex items-center gap-2">
                            <span class="text-xl">${railEmpireInfo[parseInt(row.empire)].symbol}</span>
                            <span class="font-mono">${row.empire}</span>
                        </span>
                    </td>
                    <td class="py-4 px-4 font-medium">${row.country}</td>
                    <td class="py-4 px-4 text-slate-300">${row.city}</td>
                    <td class="py-4 px-4 text-slate-300">${row.line}</td>
                    <td class="py-4 px-4 text-right font-mono text-lg" style="color: ${railEmpireInfo[parseInt(row.empire)].color}">
                        ${row.length.toLocaleString()}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function initRail() {
            loadRailData().then(data => {
                if (data.length === 0) {
                    console.error('No rail data loaded');
                    return;
                }

                console.log(`Loaded ${data.length} rail lines`);
                updateRailSummaryCards(data);
                createRailTotalLengthChart(data);
                createRailDistributionChart(data);
                createRailTopLinesChart(data);
                createRailCountryChart(data);
                createRailDataTable(data);
                window.railDataLoaded = true;
            });
        }

        // Initialize Market Cap (placeholder - implement as needed)
        function initMarketCap() {
            // Sample data for demo; replace with fetch
            const sampleData = [
                { rank: 1, name: 'British Petroleum', cap: 150000, empire: 2 },
                { rank: 2, name: 'Tesla Inc.', cap: 120000, empire: 2 },
                // Add more...
            ];
            // Update leader panel, pie, tables...
            console.log('Market Cap initialized');
        }

        // Init on load
        document.addEventListener('DOMContentLoaded', () => {
            initMarketCap();
            initHSR();  // Load HSR by default
        });
    </script>
</body>
</html>
