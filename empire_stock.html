<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empire Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 40px rgba(59, 130, 246, 0.8); }
        }
        
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        body {
            background: linear-gradient(-45deg, #0f172a, #1e293b, #0c1e3d, #1a1f3a);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        
        .card-glow {
            position: relative;
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .card-glow:hover {
            transform: translateY(-5px);
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), 0 0 30px rgba(59, 130, 246, 0.3);
        }
        
        .empire-img {
            transition: all 0.3s ease;
            filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.3));
        }
        
        .empire-img:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.6));
        }
        
        .table-row {
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        
        .table-row:hover {
            background: rgba(59, 130, 246, 0.1);
            border-left-color: #3b82f6;
            transform: translateX(5px);
        }
        
        .shimmer-text {
            background: linear-gradient(90deg, #fff 0%, #60a5fa 50%, #fff 100%);
            background-size: 1000px 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shimmer 3s linear infinite;
        }
        
        .neon-border {
            position: relative;
            border: 2px solid transparent;
            background: linear-gradient(rgba(30, 41, 59, 0.8), rgba(30, 41, 59, 0.8)) padding-box,
                        linear-gradient(45deg, #3b82f6, #8b5cf6, #3b82f6) border-box;
        }
    </style>
</head>
<body class="min-h-screen p-8">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-6xl font-bold shimmer-text mb-2">Global Empire Dashboard</h1>
            <p class="text-blue-400 text-lg">Real-time Market Intelligence & Research Analytics</p>
            <p class="text-slate-500 text-sm mt-2">Last Updated: October 18, 2025</p>
        </div>

        <!-- Market Cap Section -->
        <div class="mb-16">
            <h2 class="text-3xl font-bold text-white mb-6 text-center">
                <span class="text-blue-400">ðŸ’¹</span> Market Capitalization
            </h2>
            
            <div class="grid grid-cols-2 gap-6 mb-12">
                <!-- Market Cap Leader Panel - Images Only -->
                <div class="card-glow rounded-2xl p-6">
                    <div class="flex items-center justify-center space-x-0">
                        <img src="https://raw.githubusercontent.com/ayeeff/marketcap/refs/heads/main/img/emp2.png" 
                             alt="Empire 2" class="empire-img w-40 h-40 object-contain -mr-4">
                        <img src="https://raw.githubusercontent.com/ayeeff/marketcap/refs/heads/main/img/emp3.png" 
                             alt="Empire 3" class="empire-img w-40 h-40 object-contain -mr-4">
                        <img src="https://raw.githubusercontent.com/ayeeff/marketcap/refs/heads/main/img/emp1.png" 
                             alt="Empire 1" class="empire-img w-40 h-40 object-contain">
                    </div>
                </div>

                <!-- Market Cap Pie Chart -->
                <div class="card-glow rounded-2xl p-6">
                    <div id="marketCapPie" class="w-full"></div>
                </div>
            </div>

            <!-- Market Cap Company Tables -->
            <div class="grid grid-cols-3 gap-6">
                <div class="card-glow rounded-2xl p-6">
                    <div class="mb-4 border-b border-slate-700 pb-3">
                        <h3 class="text-xl font-bold text-white mb-1">Empire 1</h3>
                        <span class="text-amber-400 text-sm font-bold">Top Companies</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead>
                                <tr class="border-b border-slate-700">
                                    <th class="pb-2 text-slate-400 font-semibold text-xs">#</th>
                                    <th class="pb-2 text-slate-400 font-semibold text-xs">Company</th>
                                    <th class="pb-2 text-slate-400 font-semibold text-xs text-right">Cap</th>
                                </tr>
                            </thead>
                            <tbody id="marketEmpire1Table" class="text-white"></tbody>
                        </table>
                    </div>
                </div>

                <div class="card-glow rounded-2xl p-6">
                    <div class="mb-4 border-b border-slate-700 pb-3">
                        <h3 class="text-xl font-bold text-white mb-1">Empire 2</h3>
                        <span class="text-blue-400 text-sm font-bold">Top Companies</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead>
                                <tr class="border-b border-slate-700">
                                    <th class="pb-2 text-slate-400 font-semibold text-xs">#</th>
                                    <th class="pb-2 text-slate-400 font-semibold text-xs">Company</th>
                                    <th class="pb-2 text-slate-400 font-semibold text-xs text-right">Cap</th>
                                </tr>
                            </thead>
                            <tbody id="marketEmpire2Table" class="text-white"></tbody>
                        </table>
                    </div>
                </div>

                <div class="card-glow rounded-2xl p-6">
                    <div class="mb-4 border-b border-slate-700 pb-3">
                        <h3 class="text-xl font-bold text-white mb-1">Empire 3</h3>
                        <span class="text-red-400 text-sm font-bold">Top Companies</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead>
                                <tr class="border-b border-slate-700">
                                    <th class="pb-2 text-slate-400 font-semibold text-xs">#</th>
                                    <th class="pb-2 text-slate-400 font-semibold text-xs">Company</th>
                                    <th class="pb-2 text-slate-400 font-semibold text-xs text-right">Cap</th>
                                </tr>
                            </thead>
                            <tbody id="marketEmpire3Table" class="text-white"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- R&D Expenditure Section -->
        <div class="mb-16">
            <h2 class="text-3xl font-bold text-white mb-6 text-center">
                <span class="text-purple-400">ðŸ”¬</span> 2025 Research Leaders: Leading Countries/Institutions via Nature Index
            </h2>
            
            <div class="grid grid-cols-2 gap-6 mb-12">
                <!-- R&D Leader Panel - Images Only -->
                <div class="card-glow rounded-2xl p-6">
                    <div class="flex items-center justify-center space-x-0">
                        <img src="https://raw.githubusercontent.com/ayeeff/marketcap/refs/heads/main/img/emp1.png" 
                             alt="Empire 1" class="empire-img w-40 h-40 object-contain -mr-4">
                        <img src="https://raw.githubusercontent.com/ayeeff/marketcap/refs/heads/main/img/emp2.png" 
                             alt="Empire 2" class="empire-img w-40 h-40 object-contain -mr-4">
                        <img src="https://raw.githubusercontent.com/ayeeff/marketcap/refs/heads/main/img/emp3.png" 
                             alt="Empire 3" class="empire-img w-40 h-40 object-contain">
                    </div>
                </div>

                <!-- R&D Pie Chart -->
                <div class="card-glow rounded-2xl p-6">
                    <div id="rdPie" class="w-full"></div>
                </div>
            </div>

            <!-- Research Institution Tables -->
            <div class="grid grid-cols-3 gap-6">
                <div class="card-glow rounded-2xl p-6">
                    <div class="mb-4 border-b border-slate-700 pb-3">
                        <h3 class="text-xl font-bold text-white mb-1">Empire 1</h3>
                        <span class="text-amber-400 text-sm font-bold">Top Institutions</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead>
                                <tr class="border-b border-slate-700">
                                    <th class="pb-2 text-slate-400 font-semibold text-xs">#</th>
                                    <th class="pb-2 text-slate-400 font-semibold text-xs">Institution</th>
                                    <th class="pb-2 text-slate-400 font-semibold text-xs text-right">Rank</th>
                                </tr>
                            </thead>
                            <tbody id="researchEmpire1Table" class="text-white"></tbody>
                        </table>
                    </div>
                </div>

                <div class="card-glow rounded-2xl p-6">
                    <div class="mb-4 border-b border-slate-700 pb-3">
                        <h3 class="text-xl font-bold text-white mb-1">Empire 2</h3>
                        <span class="text-blue-400 text-sm font-bold">Top Institutions</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead>
                                <tr class="border-b border-slate-700">
                                    <th class="pb-2 text-slate-400 font-semibold text-xs">#</th>
                                    <th class="pb-2 text-slate-400 font-semibold text-xs">Institution</th>
                                    <th class="pb-2 text-slate-400 font-semibold text-xs text-right">Rank</th>
                                </tr>
                            </thead>
                            <tbody id="researchEmpire2Table" class="text-white"></tbody>
                        </table>
                    </div>
                </div>

                <div class="card-glow rounded-2xl p-6">
                    <div class="mb-4 border-b border-slate-700 pb-3">
                        <h3 class="text-xl font-bold text-white mb-1">Empire 3</h3>
                        <span class="text-red-400 text-sm font-bold">Top Institutions</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead>
                                <tr class="border-b border-slate-700">
                                    <th class="pb-2 text-slate-400 font-semibold text-xs">#</th>
                                    <th class="pb-2 text-slate-400 font-semibold text-xs">Institution</th>
                                    <th class="pb-2 text-slate-400 font-semibold text-xs text-right">Rank</th>
                                </tr>
                            </thead>
                            <tbody id="researchEmpire3Table" class="text-white"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        let companies = [];
        let institutions = [];
        let marketCapTotals = [];
        let rdExpenditures = [];
        
        // GitHub raw file URLs
        const GITHUB_BASE = 'https://raw.githubusercontent.com/ayeeff/marketcap/main/data/';
        
        // Load CSV data
        async function loadData() {
            try {
                // Load companies CSV
                const companiesResponse = await fetch(GITHUB_BASE + 'empire_top_companies.csv');
                const companiesData = await companiesResponse.text();
                const companiesParsed = Papa.parse(companiesData, {
                    header: true,
                    skipEmptyLines: true,
                    dynamicTyping: false
                });
                
                companies = companiesParsed.data.map(row => {
                    const companyName = row.Company.split('\n')[0].trim();
                    return {
                        empire: parseInt(row.Empire),
                        name: companyName,
                        ticker: row.Company.split('\n')[1]?.trim() || '',
                        marketCap: row['Market Cap']
                    };
                });
                
                // Load research institutions CSV
                const researchResponse = await fetch(GITHUB_BASE + 'empire_research.csv');
                const researchData = await researchResponse.text();
                const researchParsed = Papa.parse(researchData, {
                    header: true,
                    skipEmptyLines: true,
                    dynamicTyping: true
                });
                
                institutions = researchParsed.data.map(row => ({
                    empire: parseInt(row.Empire),
                    rank: parseInt(row.Empire_Rank),
                    name: row.Institution,
                    globalRank: parseInt(row.Global_Rank)
                }));
                
                // Load market cap totals CSV
                const marketCapResponse = await fetch(GITHUB_BASE + 'empire_totals.csv');
                const marketCapData = await marketCapResponse.text();
                const marketCapParsed = Papa.parse(marketCapData, {
                    header: true,
                    skipEmptyLines: true,
                    dynamicTyping: false
                });
                
                marketCapTotals = marketCapParsed.data.map(row => ({
                    empire: parseInt(row.Empire),
                    total: row['Total Market Cap'],
                    date: row.Date
                }));
                
                // Load R&D expenditure CSV
                const rdResponse = await fetch(GITHUB_BASE + 'empire_nature_share.csv');
                const rdData = await rdResponse.text();
                const rdParsed = Papa.parse(rdData, {
                    header: true,
                    skipEmptyLines: true,
                    dynamicTyping: true
                });

                rdExpenditures = rdParsed.data.map(row => ({
                    empire: parseInt(row.empire),
                    share: parseFloat(row.share_2024),
                    percent: parseFloat(row.percent)
                }));

                // Sort by percent in descending order for ranking
                rdExpenditures.sort((a, b) => b.percent - a.percent);
                
                // Initialize dashboard
                initDashboard();
            } catch (error) {
                console.error('Error loading data:', error);
                document.body.innerHTML += `<div style="color: red; text-align: center; padding: 20px;">Error loading data: ${error.message}</div>`;
            }
        }

        // Populate Market Cap Tables
        function populateMarketTable(empireNum) {
            const tableBody = document.getElementById(`marketEmpire${empireNum}Table`);
            const empireCompanies = companies.filter(c => c.empire === empireNum);
            
            empireCompanies.forEach((company, index) => {
                const row = document.createElement('tr');
                row.className = 'table-row border-b border-slate-700/50';
                row.innerHTML = `
                    <td class="py-2 text-slate-300 text-xs">${index + 1}</td>
                    <td class="py-2 text-xs">${company.name}</td>
                    <td class="py-2 text-right font-mono text-green-400 text-xs">${company.marketCap}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Populate Research Tables
        function populateResearchTable(empireNum) {
            const tableBody = document.getElementById(`researchEmpire${empireNum}Table`);
            const empireInstitutions = institutions.filter(i => i.empire === empireNum);
            
            empireInstitutions.forEach((inst) => {
                const row = document.createElement('tr');
                row.className = 'table-row border-b border-slate-700/50';
                row.innerHTML = `
                    <td class="py-2 text-slate-300 text-xs">${inst.rank}</td>
                    <td class="py-2 text-xs">${inst.name}</td>
                    <td class="py-2 text-right font-mono text-purple-400 text-xs">#${inst.globalRank}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        
        function initDashboard() {
            // Populate all tables
            [1, 2, 3].forEach(empire => {
                populateMarketTable(empire);
                populateResearchTable(empire);
            });

            // Market Cap Pie Chart
            const marketCapData = [{
            values: [70.01, 23.69, 12.27],
            labels: ['Empire 2<br>$70.01T', 'Empire 3<br>$23.69T', 'Empire 1<br>$12.27T'],
            type: 'pie',
            marker: {
                colors: ['#3b82f6', '#ef4444', '#f59e0b'],
                line: {
                    color: '#1e293b',
                    width: 2
                }
            },
            textinfo: 'label+percent',
            textposition: 'inside',
            textfont: {
                size: 13,
                color: '#ffffff',
                family: 'sans-serif'
            },
            hovertemplate: '<b>%{label}</b><br>%{percent}<extra></extra>'
        }];

        const marketCapLayout = {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            showlegend: false,
            margin: {t: 10, b: 10, l: 10, r: 10},
            height: 280
        };

        // R&D Pie Chart - Updated to use nature share data
        const rdData = [{
            values: rdExpenditures.map(item => item.share),
            labels: rdExpenditures.map(item => `Empire ${item.empire}<br>$${item.share.toLocaleString()}B (${item.percent}%)`),
            type: 'pie',
            marker: {
                colors: rdExpenditures.map(item => {
                    // Assign colors based on empire number
                    switch(item.empire) {
                        case 1: return '#f59e0b'; // amber
                        case 2: return '#3b82f6'; // blue
                        case 3: return '#ef4444'; // red
                        default: return '#6b7280'; // gray fallback
                    }
                }),
                line: {
                    color: '#1e293b',
                    width: 2
                }
            },
            textinfo: 'label',
            textposition: 'inside',
            textfont: {
                size: 12,
                color: '#ffffff',
                family: 'sans-serif'
            },
            hovertemplate: '<b>%{label}</b><extra></extra>'
        }];

        const rdLayout = {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            showlegend: false,
            margin: {t: 10, b: 10, l: 10, r: 10},
            height: 280
        };

        const config = {
            responsive: true,
            displayModeBar: false
        };

        Plotly.newPlot('marketCapPie', marketCapData, marketCapLayout, config);
        Plotly.newPlot('rdPie', rdData, rdLayout, config);
        }
        
        // Load data when page loads
        loadData();
    </script>
</body>
</html>
