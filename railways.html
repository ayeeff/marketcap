<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empire Metro Systems - Rail Infrastructure Comparison</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Space Grotesk', sans-serif;
        }
        
        .rail-line {
            background: linear-gradient(90deg, 
                transparent 0%, 
                transparent calc(50% - 2px), 
                currentColor calc(50% - 2px), 
                currentColor calc(50% + 2px), 
                transparent calc(50% + 2px), 
                transparent 100%
            );
            position: relative;
        }
        
        .rail-line::before,
        .rail-line::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: currentColor;
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .rail-line::before { left: 0; }
        .rail-line::after { right: 0; }
        
        .empire-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }
        
        .empire-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .steam-gradient {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        }
        
        .oil-gradient {
            background: linear-gradient(135deg, #b91c1c 0%, #ef4444 100%);
        }
        
        .tech-gradient {
            background: linear-gradient(135deg, #15803d 0%, #22c55e 100%);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 min-h-screen text-white">
    
    <!-- Header -->
    <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-12">
            <h1 class="text-5xl font-bold mb-4 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
                Empire Metro Systems
            </h1>
            <p class="text-xl text-slate-300">Comparing Urban Rail Infrastructure Across Three Economic Eras</p>
            <div class="rail-line text-blue-400 h-1 w-64 mx-auto mt-6"></div>
        </div>

        <!-- Empire Overview Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            <!-- Empire 1 -->
            <div class="empire-card rounded-xl p-6 steam-gradient">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center text-2xl">
                        üöÇ
                    </div>
                    <div>
                        <div class="text-sm text-blue-200">Empire 1.0</div>
                        <div class="font-bold">Steam & Colonies</div>
                    </div>
                </div>
                <div class="text-sm text-blue-100 mb-4">British Commonwealth (excluding India)</div>
                <div class="flex justify-between items-end">
                    <div>
                        <div class="text-3xl font-bold" id="empire1-total">-</div>
                        <div class="text-sm text-blue-200">Total km</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold" id="empire1-cities">-</div>
                        <div class="text-sm text-blue-200">Cities</div>
                    </div>
                </div>
            </div>

            <!-- Empire 2 -->
            <div class="empire-card rounded-xl p-6 oil-gradient">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center text-2xl">
                        üõ¢Ô∏è
                    </div>
                    <div>
                        <div class="text-sm text-red-200">Empire 2.0</div>
                        <div class="font-bold">Oil & Silicon</div>
                    </div>
                </div>
                <div class="text-sm text-red-100 mb-4">United States</div>
                <div class="flex justify-between items-end">
                    <div>
                        <div class="text-3xl font-bold" id="empire2-total">-</div>
                        <div class="text-sm text-red-200">Total km</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold" id="empire2-cities">-</div>
                        <div class="text-sm text-red-200">Cities</div>
                    </div>
                </div>
            </div>

            <!-- Empire 3 -->
            <div class="empire-card rounded-xl p-6 tech-gradient">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center text-2xl">
                        ü§ñ
                    </div>
                    <div>
                        <div class="text-sm text-green-200">Empire 3.0</div>
                        <div class="font-bold">Rare Earths & Robotics</div>
                    </div>
                </div>
                <div class="text-sm text-green-100 mb-4">China + Hong Kong + Taiwan</div>
                <div class="flex justify-between items-end">
                    <div>
                        <div class="text-3xl font-bold" id="empire3-total">-</div>
                        <div class="text-sm text-green-200">Total km</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold" id="empire3-cities">-</div>
                        <div class="text-sm text-green-200">Cities</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-12">
            <!-- Total Length Comparison -->
            <div class="empire-card rounded-xl p-6">
                <h2 class="text-2xl font-bold mb-4">Total Metro Length by Empire</h2>
                <div id="totalLengthChart"></div>
            </div>

            <!-- Distribution by Empire -->
            <div class="empire-card rounded-xl p-6">
                <h2 class="text-2xl font-bold mb-4">Metro Network Distribution</h2>
                <div id="distributionChart"></div>
            </div>
        </div>

        <!-- Top Cities -->
        <div class="empire-card rounded-xl p-6 mb-12">
            <h2 class="text-2xl font-bold mb-6">Top 15 Metro Systems by Length</h2>
            <div id="topCitiesChart"></div>
        </div>

        <!-- Country Breakdown -->
        <div class="empire-card rounded-xl p-6 mb-12">
            <h2 class="text-2xl font-bold mb-6">Metro Length by Country</h2>
            <div id="countryChart"></div>
        </div>

        <!-- Data Table -->
        <div class="empire-card rounded-xl p-6">
            <h2 class="text-2xl font-bold mb-6">Detailed Metro Systems</h2>
            <div class="overflow-x-auto">
                <table class="w-full text-sm" id="dataTable">
                    <thead>
                        <tr class="border-b border-slate-600">
                            <th class="text-left py-3 px-4">Empire</th>
                            <th class="text-left py-3 px-4">Country</th>
                            <th class="text-left py-3 px-4">City</th>
                            <th class="text-left py-3 px-4">Name</th>
                            <th class="text-right py-3 px-4">Length (km)</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Empire metadata
        const empireInfo = {
            '1': { name: 'Steam & Colonies', color: '#3b82f6', fullName: 'Empire 1.0: Steam & Colonies' },
            '2': { name: 'Oil & Silicon', color: '#ef4444', fullName: 'Empire 2.0: Oil & Silicon' },
            '3': { name: 'Rare Earths & Robotics', color: '#22c55e', fullName: 'Empire 3.0: Rare Earths & Robotics' }
        };

        // Load and process data
        async function loadData() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/ayeeff/marketcap/main/data/empire_metro.csv');
                const csvText = await response.text();
                
                // Parse CSV
                const lines = csvText.trim().split('\n');
                const headers = lines[0].split(',');
                const data = lines.slice(1).map(line => {
                    const values = line.split(',');
                    return {
                        empire: values[0],
                        country: values[1],
                        city: values[2],
                        name: values[3] || values[2],
                        length: parseFloat(values[4]) || 0
                    };
                });

                return data;
            } catch (error) {
                console.error('Error loading data:', error);
                return [];
            }
        }

        function updateSummaryCards(data) {
            ['1', '2', '3'].forEach(empire => {
                const empireData = data.filter(d => d.empire === empire);
                const totalLength = empireData.reduce((sum, d) => sum + d.length, 0);
                const cities = new Set(empireData.map(d => d.city)).size;
                
                document.getElementById(`empire${empire}-total`).textContent = totalLength.toLocaleString(undefined, {maximumFractionDigits: 0}) + ' km';
                document.getElementById(`empire${empire}-cities`).textContent = cities;
            });
        }

        function createTotalLengthChart(data) {
            const empireData = ['1', '2', '3'].map(empire => {
                const filtered = data.filter(d => d.empire === empire);
                const total = filtered.reduce((sum, d) => sum + d.length, 0);
                return {
                    empire: empire,
                    total: total,
                    name: empireInfo[empire].name,
                    color: empireInfo[empire].color
                };
            });

            const trace = {
                x: empireData.map(d => d.name),
                y: empireData.map(d => d.total),
                type: 'bar',
                marker: {
                    color: empireData.map(d => d.color),
                    line: { color: 'rgba(255,255,255,0.2)', width: 2 }
                },
                text: empireData.map(d => d.total.toLocaleString() + ' km'),
                textposition: 'outside',
                textfont: { color: 'white', size: 14, family: 'Space Grotesk' }
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white', family: 'Space Grotesk' },
                xaxis: { showgrid: false },
                yaxis: { 
                    showgrid: true, 
                    gridcolor: 'rgba(255,255,255,0.1)',
                    title: 'Total Length (km)'
                },
                margin: { t: 20, r: 20, b: 60, l: 60 },
                height: 300
            };

            Plotly.newPlot('totalLengthChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createDistributionChart(data) {
            const empireData = ['1', '2', '3'].map(empire => {
                const filtered = data.filter(d => d.empire === empire);
                const total = filtered.reduce((sum, d) => sum + d.length, 0);
                return {
                    empire: empire,
                    total: total,
                    name: empireInfo[empire].name,
                    color: empireInfo[empire].color
                };
            });

            const trace = {
                labels: empireData.map(d => d.name),
                values: empireData.map(d => d.total),
                type: 'pie',
                marker: {
                    colors: empireData.map(d => d.color),
                    line: { color: 'rgba(255,255,255,0.2)', width: 2 }
                },
                textinfo: 'label+percent',
                textfont: { color: 'white', size: 12, family: 'Space Grotesk' },
                hovertemplate: '<b>%{label}</b><br>%{value:,.0f} km<br>%{percent}<extra></extra>'
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white', family: 'Space Grotesk' },
                showlegend: false,
                margin: { t: 20, r: 20, b: 20, l: 20 },
                height: 300
            };

            Plotly.newPlot('distributionChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createTopCitiesChart(data) {
            const sortedData = [...data].sort((a, b) => b.length - a.length).slice(0, 15);

            const trace = {
                x: sortedData.map(d => d.length),
                y: sortedData.map(d => `${d.city}, ${d.country}`),
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: sortedData.map(d => empireInfo[d.empire].color),
                    line: { color: 'rgba(255,255,255,0.2)', width: 1 }
                },
                text: sortedData.map(d => d.length.toLocaleString() + ' km'),
                textposition: 'outside',
                textfont: { color: 'white', size: 11, family: 'Space Grotesk' }
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white', family: 'Space Grotesk', size: 11 },
                xaxis: { 
                    showgrid: true, 
                    gridcolor: 'rgba(255,255,255,0.1)',
                    title: 'Length (km)'
                },
                yaxis: { showgrid: false, automargin: true },
                margin: { t: 20, r: 100, b: 60, l: 200 },
                height: 500
            };

            Plotly.newPlot('topCitiesChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createCountryChart(data) {
            // Aggregate by country
            const countryData = {};
            data.forEach(d => {
                if (!countryData[d.country]) {
                    countryData[d.country] = {
                        total: 0,
                        empire: d.empire,
                        country: d.country
                    };
                }
                countryData[d.country].total += d.length;
            });

            const sortedCountries = Object.values(countryData)
                .sort((a, b) => b.total - a.total)
                .slice(0, 20);

            const trace = {
                x: sortedCountries.map(d => d.country),
                y: sortedCountries.map(d => d.total),
                type: 'bar',
                marker: {
                    color: sortedCountries.map(d => empireInfo[d.empire].color),
                    line: { color: 'rgba(255,255,255,0.2)', width: 1 }
                },
                text: sortedCountries.map(d => d.total.toLocaleString() + ' km'),
                textposition: 'outside',
                textfont: { color: 'white', size: 11, family: 'Space Grotesk' }
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white', family: 'Space Grotesk' },
                xaxis: { showgrid: false, tickangle: -45 },
                yaxis: { 
                    showgrid: true, 
                    gridcolor: 'rgba(255,255,255,0.1)',
                    title: 'Total Metro Length (km)'
                },
                margin: { t: 20, r: 20, b: 120, l: 60 },
                height: 400
            };

            Plotly.newPlot('countryChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createDataTable(data) {
            const tbody = document.getElementById('tableBody');
            const sortedData = [...data].sort((a, b) => b.length - a.length);
            
            sortedData.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-slate-700 hover:bg-white/5';
                tr.innerHTML = `
                    <td class="py-3 px-4">
                        <span class="inline-block w-3 h-3 rounded-full mr-2" style="background-color: ${empireInfo[row.empire].color}"></span>
                        ${row.empire}
                    </td>
                    <td class="py-3 px-4">${row.country}</td>
                    <td class="py-3 px-4 font-semibold">${row.city}</td>
                    <td class="py-3 px-4">${row.name}</td>
                    <td class="py-3 px-4 text-right font-mono">${row.length.toLocaleString()}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Initialize
        loadData().then(data => {
            if (data.length === 0) {
                console.error('No data loaded');
                return;
            }

            updateSummaryCards(data);
            createTotalLengthChart(data);
            createDistributionChart(data);
            createTopCitiesChart(data);
            createCountryChart(data);
            createDataTable(data);
        });
    </script>
</body>
</html>
