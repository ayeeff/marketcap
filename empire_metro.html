<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empire Metro Systems - Rail Infrastructure Comparison</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: #0a0e27;
            overflow-x: hidden;
        }
        
        /* Animated background */
        .cyber-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, rgba(0, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(180deg, rgba(0, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: 0;
            animation: gridScroll 20s linear infinite;
        }
        
        @keyframes gridScroll {
            0% { transform: translateY(0); }
            100% { transform: translateY(50px); }
        }
        
        .neon-glow {
            text-shadow: 
                0 0 10px currentColor,
                0 0 20px currentColor,
                0 0 30px currentColor,
                0 0 40px currentColor;
        }
        
        .hologram-card {
            background: linear-gradient(135deg, 
                rgba(10, 20, 50, 0.8) 0%, 
                rgba(20, 30, 60, 0.6) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 255, 255, 0.3);
            box-shadow: 
                0 0 20px rgba(0, 255, 255, 0.2),
                inset 0 0 20px rgba(0, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hologram-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(0, 255, 255, 0.1) 50%,
                transparent 70%
            );
            animation: scan 3s linear infinite;
        }
        
        @keyframes scan {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .hologram-card:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: rgba(0, 255, 255, 0.6);
            box-shadow: 
                0 0 40px rgba(0, 255, 255, 0.4),
                inset 0 0 30px rgba(0, 255, 255, 0.1);
        }
        
        .empire-1-glow {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
        }
        
        .empire-2-glow {
            background: linear-gradient(135deg, #450a0a 0%, #991b1b 100%);
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.5);
        }
        
        .empire-3-glow {
            background: linear-gradient(135deg, #052e16 0%, #166534 100%);
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.5);
        }
        
        .data-stream {
            position: relative;
            overflow: hidden;
        }
        
        .data-stream::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 255, 255, 0.3) 50%, 
                transparent 100%);
            animation: stream 2s ease-in-out infinite;
        }
        
        @keyframes stream {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .metric-display {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            letter-spacing: 2px;
        }
        
        .pulse-dot {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .hex-pattern {
            background-image: 
                radial-gradient(circle at center, rgba(0, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 30px 30px;
        }
        
        .cyber-border {
            position: relative;
            padding: 2px;
            background: linear-gradient(45deg, #00ffff, #0080ff, #ff00ff, #00ffff);
            background-size: 300% 300%;
            animation: borderFlow 4s ease infinite;
        }
        
        @keyframes borderFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .glitch {
            position: relative;
        }
        
        .glitch::before,
        .glitch::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .glitch::before {
            left: 2px;
            text-shadow: -2px 0 #00ffff;
            clip: rect(24px, 550px, 90px, 0);
            animation: glitch-anim 3s infinite linear alternate-reverse;
        }
        
        .glitch::after {
            left: -2px;
            text-shadow: -2px 0 #ff00ff;
            clip: rect(85px, 550px, 140px, 0);
            animation: glitch-anim 2.5s infinite linear alternate-reverse;
        }
        
        @keyframes glitch-anim {
            0% { clip: rect(random(100) + px, 9999px, random(100) + px, 0); }
            100% { clip: rect(random(100) + px, 9999px, random(100) + px, 0); }
        }
        
        table {
            border-collapse: separate;
            border-spacing: 0;
        }
        
        tbody tr {
            border-left: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        tbody tr:hover {
            background: rgba(0, 255, 255, 0.1) !important;
            border-left-color: #00ffff;
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
            box-shadow: 0 0 10px currentColor;
        }
    </style>
</head>
<body class="relative">
    <div class="cyber-grid"></div>
    
    <div class="relative z-10 container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-16">
            <div class="inline-block mb-6">
                <h1 class="text-6xl md:text-7xl font-black mb-2 glitch" data-text="METRO SYSTEMS" style="font-family: 'Orbitron', monospace; color: #00ffff;">
                    METRO SYSTEMS
                </h1>
            </div>
            <p class="text-2xl text-cyan-400 mb-4" style="font-family: 'Rajdhani', sans-serif; font-weight: 500;">
                GLOBAL RAIL INFRASTRUCTURE ANALYSIS
            </p>
            <div class="flex items-center justify-center gap-4 text-cyan-500">
                <div class="w-16 h-px bg-gradient-to-r from-transparent via-cyan-500 to-transparent"></div>
                <span class="text-xs tracking-widest">REAL-TIME DATA VISUALIZATION</span>
                <div class="w-16 h-px bg-gradient-to-r from-transparent via-cyan-500 to-transparent"></div>
            </div>
        </div>

        <!-- Empire Overview Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-16">
            <!-- Empire 1 -->
            <div class="cyber-border rounded-2xl">
                <div class="hologram-card empire-1-glow rounded-2xl p-6 h-full">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-14 h-14 bg-blue-500/20 rounded-xl flex items-center justify-center text-3xl border border-blue-400/30">
                            üöÇ
                        </div>
                        <div>
                            <div class="text-xs text-blue-400 tracking-widest font-bold">EMPIRE 1.0</div>
                            <div class="text-xl font-bold text-cyan-300" style="font-family: 'Orbitron', monospace;">STEAM ERA</div>
                        </div>
                    </div>
                    <div class="text-sm text-blue-300 mb-6 opacity-80">British Commonwealth Network</div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="data-stream bg-blue-950/50 p-3 rounded-lg border border-blue-500/30">
                            <div class="metric-display text-3xl text-cyan-400 mb-1" id="empire1-total">-</div>
                            <div class="text-xs text-blue-400 tracking-wider">TOTAL KM</div>
                        </div>
                        <div class="data-stream bg-blue-950/50 p-3 rounded-lg border border-blue-500/30">
                            <div class="metric-display text-3xl text-cyan-400 mb-1" id="empire1-cities">-</div>
                            <div class="text-xs text-blue-400 tracking-wider">CITIES</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Empire 2 -->
            <div class="cyber-border rounded-2xl">
                <div class="hologram-card empire-2-glow rounded-2xl p-6 h-full">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-14 h-14 bg-red-500/20 rounded-xl flex items-center justify-center text-3xl border border-red-400/30">
                            üõ¢Ô∏è
                        </div>
                        <div>
                            <div class="text-xs text-red-400 tracking-widest font-bold">EMPIRE 2.0</div>
                            <div class="text-xl font-bold text-red-300" style="font-family: 'Orbitron', monospace;">OIL ERA</div>
                        </div>
                    </div>
                    <div class="text-sm text-red-300 mb-6 opacity-80">United States Infrastructure</div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="data-stream bg-red-950/50 p-3 rounded-lg border border-red-500/30">
                            <div class="metric-display text-3xl text-red-400 mb-1" id="empire2-total">-</div>
                            <div class="text-xs text-red-400 tracking-wider">TOTAL KM</div>
                        </div>
                        <div class="data-stream bg-red-950/50 p-3 rounded-lg border border-red-500/30">
                            <div class="metric-display text-3xl text-red-400 mb-1" id="empire2-cities">-</div>
                            <div class="text-xs text-red-400 tracking-wider">CITIES</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Empire 3 -->
            <div class="cyber-border rounded-2xl">
                <div class="hologram-card empire-3-glow rounded-2xl p-6 h-full">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-14 h-14 bg-green-500/20 rounded-xl flex items-center justify-center text-3xl border border-green-400/30">
                            ü§ñ
                        </div>
                        <div>
                            <div class="text-xs text-green-400 tracking-widest font-bold">EMPIRE 3.0</div>
                            <div class="text-xl font-bold text-green-300" style="font-family: 'Orbitron', monospace;">TECH ERA</div>
                        </div>
                    </div>
                    <div class="text-sm text-green-300 mb-6 opacity-80">China + HK + Taiwan Systems</div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="data-stream bg-green-950/50 p-3 rounded-lg border border-green-500/30">
                            <div class="metric-display text-3xl text-green-400 mb-1" id="empire3-total">-</div>
                            <div class="text-xs text-green-400 tracking-wider">TOTAL KM</div>
                        </div>
                        <div class="data-stream bg-green-950/50 p-3 rounded-lg border border-green-500/30">
                            <div class="metric-display text-3xl text-green-400 mb-1" id="empire3-cities">-</div>
                            <div class="text-xs text-green-400 tracking-wider">CITIES</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-12">
            <!-- Total Length Comparison -->
            <div class="hologram-card rounded-2xl p-6">
                <h2 class="text-2xl font-bold mb-6 text-cyan-400" style="font-family: 'Orbitron', monospace;">
                    <span class="pulse-dot inline-block w-2 h-2 bg-cyan-400 rounded-full mr-2"></span>
                    TOTAL LENGTH ANALYSIS
                </h2>
                <div id="totalLengthChart"></div>
            </div>

            <!-- Distribution by Empire -->
            <div class="hologram-card rounded-2xl p-6">
                <h2 class="text-2xl font-bold mb-6 text-cyan-400" style="font-family: 'Orbitron', monospace;">
                    <span class="pulse-dot inline-block w-2 h-2 bg-cyan-400 rounded-full mr-2"></span>
                    NETWORK DISTRIBUTION
                </h2>
                <div id="distributionChart"></div>
            </div>
        </div>

        <!-- Top Cities -->
        <div class="hologram-card rounded-2xl p-6 mb-12">
            <h2 class="text-2xl font-bold mb-6 text-cyan-400" style="font-family: 'Orbitron', monospace;">
                <span class="pulse-dot inline-block w-2 h-2 bg-cyan-400 rounded-full mr-2"></span>
                TOP 15 METRO SYSTEMS
            </h2>
            <div id="topCitiesChart"></div>
        </div>

        <!-- Country Breakdown -->
        <div class="hologram-card rounded-2xl p-6 mb-12">
            <h2 class="text-2xl font-bold mb-6 text-cyan-400" style="font-family: 'Orbitron', monospace;">
                <span class="pulse-dot inline-block w-2 h-2 bg-cyan-400 rounded-full mr-2"></span>
                COUNTRY RANKINGS
            </h2>
            <div id="countryChart"></div>
        </div>

        <!-- Data Table -->
        <div class="hologram-card rounded-2xl p-6">
            <h2 class="text-2xl font-bold mb-6 text-cyan-400" style="font-family: 'Orbitron', monospace;">
                <span class="pulse-dot inline-block w-2 h-2 bg-cyan-400 rounded-full mr-2"></span>
                SYSTEM DATABASE
            </h2>
            <div class="overflow-x-auto">
                <table class="w-full text-sm" id="dataTable">
                    <thead>
                        <tr class="border-b-2 border-cyan-500/30">
                            <th class="text-left py-4 px-4 text-cyan-400 tracking-wider text-xs font-bold">EMPIRE</th>
                            <th class="text-left py-4 px-4 text-cyan-400 tracking-wider text-xs font-bold">COUNTRY</th>
                            <th class="text-left py-4 px-4 text-cyan-400 tracking-wider text-xs font-bold">CITY</th>
                            <th class="text-left py-4 px-4 text-cyan-400 tracking-wider text-xs font-bold">SYSTEM</th>
                            <th class="text-right py-4 px-4 text-cyan-400 tracking-wider text-xs font-bold">LENGTH (KM)</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Empire metadata
        const empireInfo = {
            '1': { name: 'Steam Era', color: '#3b82f6', fullName: 'Empire 1.0: Steam & Colonies' },
            '2': { name: 'Oil Era', color: '#ef4444', fullName: 'Empire 2.0: Oil & Silicon' },
            '3': { name: 'Tech Era', color: '#22c55e', fullName: 'Empire 3.0: Rare Earths & Robotics' }
        };

        // Load and process data
        async function loadData() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/ayeeff/marketcap/main/data/empire_metro.csv');
                const csvText = await response.text();
                
                // Parse CSV properly handling quoted fields
                const lines = csvText.trim().split('\n');
                const data = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i];
                    const values = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let j = 0; j < line.length; j++) {
                        const char = line[j];
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            values.push(current);
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    values.push(current);
                    
                    if (values.length >= 5) {
                        data.push({
                            empire: values[0].trim(),
                            country: values[1].trim(),
                            city: values[2].trim(),
                            name: values[3].trim() || values[2].trim(),
                            length: parseFloat(values[4]) || 0
                        });
                    }
                }

                return data;
            } catch (error) {
                console.error('Error loading data:', error);
                return [];
            }
        }

        function animateNumber(element, target) {
            const duration = 1500;
            const start = 0;
            const startTime = performance.now();
            
            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const current = Math.floor(start + (target - start) * progress);
                element.textContent = current.toLocaleString();
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }
            
            requestAnimationFrame(update);
        }

        function updateSummaryCards(data) {
            ['1', '2', '3'].forEach(empire => {
                const empireData = data.filter(d => d.empire === empire);
                const totalLength = empireData.reduce((sum, d) => sum + d.length, 0);
                const cities = new Set(empireData.map(d => d.city)).size;
                
                const totalEl = document.getElementById(`empire${empire}-total`);
                const citiesEl = document.getElementById(`empire${empire}-cities`);
                
                animateNumber(totalEl, Math.round(totalLength));
                animateNumber(citiesEl, cities);
            });
        }

        function createTotalLengthChart(data) {
            const empireData = ['1', '2', '3'].map(empire => {
                const filtered = data.filter(d => d.empire === empire);
                const total = filtered.reduce((sum, d) => sum + d.length, 0);
                return {
                    empire: empire,
                    total: total,
                    name: empireInfo[empire].name,
                    color: empireInfo[empire].color
                };
            });

            const trace = {
                x: empireData.map(d => d.name),
                y: empireData.map(d => d.total),
                type: 'bar',
                marker: {
                    color: empireData.map(d => d.color),
                    line: { color: 'rgba(0, 255, 255, 0.4)', width: 2 }
                },
                text: empireData.map(d => d.total.toLocaleString() + ' km'),
                textposition: 'outside',
                textfont: { color: '#00ffff', size: 14, family: 'Orbitron' }
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#00ffff', family: 'Rajdhani' },
                xaxis: { showgrid: false, color: '#00ffff' },
                yaxis: { 
                    showgrid: true, 
                    gridcolor: 'rgba(0, 255, 255, 0.1)',
                    title: { text: 'Total Length (km)', font: { color: '#00ffff' } }
                },
                margin: { t: 20, r: 20, b: 60, l: 60 },
                height: 300
            };

            Plotly.newPlot('totalLengthChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createDistributionChart(data) {
            const empireData = ['1', '2', '3'].map(empire => {
                const filtered = data.filter(d => d.empire === empire);
                const total = filtered.reduce((sum, d) => sum + d.length, 0);
                return {
                    empire: empire,
                    total: total,
                    name: empireInfo[empire].name,
                    color: empireInfo[empire].color
                };
            });

            const trace = {
                labels: empireData.map(d => d.name),
                values: empireData.map(d => d.total),
                type: 'pie',
                marker: {
                    colors: empireData.map(d => d.color),
                    line: { color: 'rgba(0, 255, 255, 0.3)', width: 2 }
                },
                textinfo: 'label+percent',
                textfont: { color: 'white', size: 12, family: 'Rajdhani' },
                hovertemplate: '<b>%{label}</b><br>%{value:,.0f} km<br>%{percent}<extra></extra>'
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#00ffff', family: 'Rajdhani' },
                showlegend: false,
                margin: { t: 20, r: 20, b: 20, l: 20 },
                height: 300
            };

            Plotly.newPlot('distributionChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createTopCitiesChart(data) {
            const sortedData = [...data].sort((a, b) => b.length - a.length).slice(0, 15);

            const trace = {
                x: sortedData.map(d => d.length),
                y: sortedData.map(d => `${d.city}, ${d.country}`),
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: sortedData.map(d => empireInfo[d.empire].color),
                    line: { color: 'rgba(0, 255, 255, 0.3)', width: 1 }
                },
                text: sortedData.map(d => d.length.toLocaleString() + ' km'),
                textposition: 'outside',
                textfont: { color: '#00ffff', size: 11, family: 'Orbitron' }
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#00ffff', family: 'Rajdhani', size: 11 },
                xaxis: { 
                    showgrid: true, 
                    gridcolor: 'rgba(0, 255, 255, 0.1)',
                    title: { text: 'Length (km)', font: { color: '#00ffff' } }
                },
                yaxis: { showgrid: false, automargin: true },
                margin: { t: 20, r: 100, b: 60, l: 200 },
                height: 500
            };

            Plotly.newPlot('topCitiesChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createCountryChart(data) {
            const countryData = {};
            data.forEach(d => {
                if (!countryData[d.country]) {
                    countryData[d.country] = {
                        total: 0,
                        empire: d.empire,
                        country: d.country
                    };
                }
                countryData[d.country].total += d.length;
            });

            const sortedCountries = Object.values(countryData)
                .sort((a, b) => b.total - a.total)
                .slice(0, 20);

            const trace = {
                x: sortedCountries.map(d => d.country),
                y: sortedCountries.map(d => d.total),
                type: 'bar',
                marker: {
                    color: sortedCountries.map(d => empireInfo[d.empire].color),
                    line: { color: 'rgba(0, 255, 255, 0.3)', width: 1 }
                },
                text: sortedCountries.map(d => d.total.toLocaleString() + ' km'),
                textposition: 'outside',
                textfont: { color: '#00ffff', size: 11, family: 'Orbitron' }
            };

            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#00ffff', family: 'Rajdhani' },
                xaxis: { showgrid: false, tickangle: -45, color: '#00ffff' },
                yaxis: { 
                    showgrid: true, 
                    gridcolor: 'rgba(0, 255, 255, 0.1)',
                    title: { text: 'Total Metro Length (km)', font: { color: '#00ffff' } }
                },
                margin: { t: 20, r: 20, b: 120, l: 60 },
                height: 400
            };

            Plotly.newPlot('countryChart', [trace], layout, {responsive: true, displayModeBar: false});
        }

        function createDataTable(data) {
            const tbody = document.getElementById('tableBody');
            const sortedData = [...data].sort((a, b) => b.length - a.length);
            
            sortedData.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-cyan-500/10 hover:bg-cyan-500/5';
                tr.innerHTML = `
                    <td class="py-4 px-4">
                        <span class="status-indicator pulse-dot" style="background-color: ${empireInfo[row.empire].color}"></span>
                        <span class="font-mono text-cyan-300">${row.empire}</span>
                    </td>
                    <td class="py-4 px-4 text-slate-300">${row.country}</td>
                    <td class="py-4 px-4 font-semibold text-cyan-200">${row.city}</td>
                    <td class="py-4 px-4 text-slate-400">${row.name}</td>
                    <td class="py-4 px-4 text-right metric-display text-cyan-400">${row.length.toLocaleString()}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Initialize
        loadData().then(data => {
            if (data.length === 0) {
                console.error('No data loaded');
                return;
            }

            console.log(`Loaded ${data.length} metro systems`);
            updateSummaryCards(data);
            createTotalLengthChart(data);
            createDistributionChart(data);
            createTopCitiesChart(data);
            createCountryChart(data);
            createDataTable(data);
        });
    </script>
</body>
</html>
